/**
 * almond 0.2.5 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/**
 * Patterns logging - minimal logging framework
 *
 * Copyright 2012 Simplon B.V.
 */

/**
 * Patterns logger - wrapper around logging library
 *
 * Copyright 2012-2013 Florian Friesdorf
 */

//     (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.

//     Underscore is freely distributable under the MIT license.

/**
 * @license
 * Patterns @VERSION@ jquery-ext - various jQuery extensions
 *
 * Copyright 2011 Humberto Sermeño
 */

/**
 * Patterns registry - Central registry and scan logic for patterns
 *
 * Copyright 2012-2013 Simplon B.V.
 * Copyright 2012-2013 Florian Friesdorf
 * Copyright 2013 Marko Durkovic
 * Copyright 2013 Rok Garbas
 */

// Patterns 
//
// Author: Rok Garbas
// Contact: rok@garbas.si
// Version: 1.0
// Depends: jquery.js
//
// Description: 
//
// License:
//
// Copyright (C) 2010 Plone Foundation
//
// This program is free software; you can redistribute it and/or modify it
// under the terms of the GNU General Public License as published by the Free
// Software Foundation; either version 2 of the License.
//
// This program is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
// more details.
//
// You should have received a copy of the GNU General Public License along with
// this program; if not, write to the Free Software Foundation, Inc., 51
// Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
//

/*
Copyright 2012 Igor Vaynberg

Version: 3.4.0 Timestamp: Tue May 14 08:27:33 PDT 2013

This software is licensed under the Apache License, Version 2.0 (the "Apache License") or the GNU
General Public License version 2 (the "GPL License"). You may choose either license to govern your
use of this software only upon the condition that you accept all of the terms of either the Apache
License or the GPL License.

You may obtain a copy of the Apache License and the GPL License at:

    http://www.apache.org/licenses/LICENSE-2.0
    http://www.gnu.org/licenses/gpl-2.0.html

Unless required by applicable law or agreed to in writing, software distributed under the
Apache License or the GPL Licesnse is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
CONDITIONS OF ANY KIND, either express or implied. See the Apache License and the GPL License for
the specific language governing permissions and limitations under the Apache License and the GPL License.
*/

/*! 
 * jquery.event.drag - v 2.2
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */

/*! 
 * jquery.event.drop - v 2.2
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */

// plone integration for textext.
//
// Author: Nathan Van Gheem
// Contact: nathan@vangheem.us
// Version: 1.0
// Depends:
//    ++resource++plone.app.jquery.js
//    ++resource++plone.app.widgets/textext.js
//
// Description:
//
// License:
//
// Copyright (C) 2010 Plone Foundation
//
// This program is free software; you can redistribute it and/or modify it
// under the terms of the GNU General Public License as published by the Free
// Software Foundation; either version 2 of the License.
//
// This program is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
// more details.
//
// You should have received a copy of the GNU General Public License along with
// this program; if not, write to the Free Software Foundation, Inc., 51
// Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
//

/*!
 * {%= pkg.title %} v{%= pkg.version %}, {%= grunt.template.today("yyyy/mm/dd") %}
 * By {%= pkg.author.name %}, {%= pkg.author.url %}
 * Hosted on {%= pkg.homepage %}
 * Licensed under {%= pkg.licenses[0].type %}
 */

/*!
 * Date picker for {%= pkg.title %} v{%= pkg.version %}
 * {%= pkg.homepage %}/date.htm
 */

/*!
 * Time picker for {%= pkg.title %} v{%= pkg.version %}
 * {%= pkg.homepage %}/time.htm
 */

// plone integration for pickadate.
//
// Author: Rok Garbas
// Contact: rok@garbas.si
// Version: 1.0
// Depends: jquery.js patterns.js pickadate.js
//
// Description:
//
// License:
//
// Copyright (C) 2010 Plone Foundation
//
// This program is free software; you can redistribute it and/or modify it
// under the terms of the GNU General Public License as published by the Free
// Software Foundation; either version 2 of the License.
//
// This program is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
// more details.
//
// You should have received a copy of the GNU General Public License along with
// this program; if not, write to the Free Software Foundation, Inc., 51
// Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
//

// Pattern which generates Table Of Contents.
//
// Author: Rok Garbas
// Contact: rok@garbas.si
// Version: 1.0
//
// License:
//
// Copyright (C) 2010 Plone Foundation
//
// This program is free software; you can redistribute it and/or modify it
// under the terms of the GNU General Public License as published by the Free
// Software Foundation; either version 2 of the License.
//
// This program is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
// more details.
//
// You should have received a copy of the GNU General Public License along with
// this program; if not, write to the Free Software Foundation, Inc., 51
// Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
//

/*!
 * jQuery Cookie Plugin v1.3.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */

// Pattern which provides accessibility support
//
// Author: Franco Pellegrini<frapell@gmail.com, Nathan Van Gheem<nathan@vangheem.us>
// Version: 1.0
//
// Taken from the original accessibility.js from Plone
//
// License:
//
// Copyright (C) 2010 Plone Foundation
//
// This program is free software; you can redistribute it and/or modify it
// under the terms of the GNU General Public License as published by the Free
// Software Foundation; either version 2 of the License.
//
// This program is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
// more details.
//
// You should have received a copy of the GNU General Public License along with
// this program; if not, write to the Free Software Foundation, Inc., 51
// Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
//

//     Underscore.js 1.4.4
//     http://underscorejs.org
//     (c) 2009-2013 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore may be freely distributed under the MIT license.

// Pattern which Plone livesearch functionality on an input
//
// Author: Nathan Van Gheem
// Contact: nathan@vangheem.us
// Version: 1.0
//
// Adapted from queryhelper.js in Plone.
//
// License:
//
// Copyright (C) 2013 Plone Foundation
//
// This program is free software; you can redistribute it and/or modify it
// under the terms of the GNU General Public License as published by the Free
// Software Foundation; either version 2 of the License.
//
// This program is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
// more details.
//
// You should have received a copy of the GNU General Public License along with
// this program; if not, write to the Free Software Foundation, Inc., 51
// Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
//

// plone integration for textext.
//
// Author: Rok Garbas
// Contact: rok@garbas.si
// Version: 1.0
// Depends:
//    ++resource++plone.app.jquery.js
//    ++resource++plone.app.widgets/textext.js
//
// Description:
//
// License:
//
// Copyright (C) 2010 Plone Foundation
//
// This program is free software; you can redistribute it and/or modify it
// under the terms of the GNU General Public License as published by the Free
// Software Foundation; either version 2 of the License.
//
// This program is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
// more details.
//
// You should have received a copy of the GNU General Public License along with
// this program; if not, write to the Free Software Foundation, Inc., 51
// Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
//

// Pattern which provide some basic form helpers:
// - prevent forms with changed values to be unloaded 
// This is going to replace 'Products/CMFPlone/skins/plone_ecmascript/formUnload.js'
// Bits of this come from 
// https://raw.github.com/mmonteleone/jquery.safetynet/master/jquery.safetynet.js
//
// Author: Simone Orsi
// Contact: simahawk@gmail.com
// Version: 1.0
//
// License:
//
// Copyright (C) 2013 Plone Foundation
//
// This program is free software; you can redistribute it and/or modify it
// under the terms of the GNU General Public License as published by the Free
// Software Foundation; either version 2 of the License.
//
// This program is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
// more details.
//
// You should have received a copy of the GNU General Public License along with
// this program; if not, write to the Free Software Foundation, Inc., 51
// Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
//

// tabs pattern.
//
// Author: Rok Garbas
// Contact: rok@garbas.si
// Version: 1.0
//
// Description:
//
// License:
//
// Copyright (C) 2010 Plone Foundation
//
// This program is free software; you can redistribute it and/or modify it
// under the terms of the GNU General Public License as published by the Free
// Software Foundation; either version 2 of the License.
//
// This program is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
// more details.
//
// You should have received a copy of the GNU General Public License along with
// this program; if not, write to the Free Software Foundation, Inc., 51
// Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
//

// Author: Rok Garbas
// Contact: rok@garbas.si
// Version: 1.0
//
// Description:
//    TinyMCE pattern (for now its depening on Plone's integration)
// 
// License:
//
// Copyright (C) 2010 Plone Foundation
//
// This program is free software; you can redistribute it and/or modify it
// under the terms of the GNU General Public License as published by the Free
// Software Foundation; either version 2 of the License.
//
// This program is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
// more details.
//
// You should have received a copy of the GNU General Public License along with
// this program; if not, write to the Free Software Foundation, Inc., 51
// Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
//

// Pattern which provide responsive image support:
//
// Author: Torkel Lyng
// Contact: torkel.lyng@gmail.com
// Version: 1.0
//
// License:
//
// Copyright (C) 2013 Plone Foundation
//
// This program is free software; you can redistribute it and/or modify it
// under the terms of the GNU General Public License as published by the Free
// Software Foundation; either version 2 of the License.
//
// This program is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
// more details.
//
// You should have received a copy of the GNU General Public License along with
// this program; if not, write to the Free Software Foundation, Inc., 51
// Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
//

// Pattern which Plone livesearch functionality on an input
//
// Author: Ryan Foster
// Contact: ryan@rynamic.com
// Version: 1.0
//
// Adapted from livesearch.js in Plone.
//
// License:
//
// Copyright (C) 2013 Plone Foundation
//
// This program is free software; you can redistribute it and/or modify it
// under the terms of the GNU General Public License as published by the Free
// Software Foundation; either version 2 of the License.
//
// This program is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
// more details.
//
// You should have received a copy of the GNU General Public License along with
// this program; if not, write to the Free Software Foundation, Inc., 51
// Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
//

// querystring pattern.
//
// Author: Rok Garbas
// Contact: rok@garbas.si
// Version: 1.0
//
// Description:
//
// License:
//
// Copyright (C) 2010 Plone Foundation
//
// This program is free software; you can redistribute it and/or modify it
// under the terms of the GNU General Public License as published by the Free
// Software Foundation; either version 2 of the License.
//
// This program is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
// more details.
//
// You should have received a copy of the GNU General Public License along with
// this program; if not, write to the Free Software Foundation, Inc., 51
// Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
//

// Pattern which provide some basic form helpers:
// - prevent forms to be submitted twice w/out warning
// This is going to replace 'Products/CMFPlone/skins/plone_ecmascript/formsubmithelpers.js'
//
// Author: Simone Orsi
// Contact: simahawk@gmail.com
// Version: 1.0
//
// License:
//
// Copyright (C) 2013 Plone Foundation
//
// This program is free software; you can redistribute it and/or modify it
// under the terms of the GNU General Public License as published by the Free
// Software Foundation; either version 2 of the License.
//
// This program is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
// more details.
//
// You should have received a copy of the GNU General Public License along with
// this program; if not, write to the Free Software Foundation, Inc., 51
// Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
//

// Author:K.K. Dhanesh 
// Contact: dhaneshkk@cdac.in
// Version: 1.0
//
// Description:
//
// License:
//
// Copyright (C) 2010 Plone Foundation
//
// This program is free software; you can redistribute it and/or modify it
// under the terms of the GNU General Public License as published by the Free
// Software Foundation; either version 2 of the License.
//
// This program is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
// more details.
//
// You should have received a copy of the GNU General Public License along with
// this program; if not, write to the Free Software Foundation, Inc., 51
// Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
//

// Author: Rok Garbas
// Contact: rok@garbas.si
// Version: 1.0
// Description:
//
// License:
//
// Copyright (C) 2010 Plone Foundation
//
// This program is free software; you can redistribute it and/or modify it
// under the terms of the GNU General Public License as published by the Free
// Software Foundation; either version 2 of the License.
//
// This program is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
// more details.
//
// You should have received a copy of the GNU General Public License along with
// this program; if not, write to the Free Software Foundation, Inc., 51
// Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
//

var requirejs,require,define;(function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!c(s,n)&&!c(a,n))throw new Error("No "+n);return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];return e=r[1],i&&(i=h(i,t),n=m(i)),i?n&&n.normalize?e=n.normalize(e,d(t)):e=h(e,t):(e=h(e,t),r=g(e),i=r[0],e=r[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return p(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}},t=function(t,n,u,f){var l,h,d,g,y,b=[],w;f=f||t;if(typeof u=="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f),h=g.f;if(h==="require")b[y]=i.require(t);else if(h==="exports")b[y]=i.exports(t),w=!0;else if(h==="module")l=b[y]=i.module(t);else if(c(s,h)||c(o,h)||c(a,h))b[y]=m(h);else{if(!g.p)throw new Error(t+" missing "+h);g.p.load(g.n,p(f,!0),v(h),{}),b[y]=s[h]}}d=u.apply(s[t],b);if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(d!==e||!w)s[t]=d}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):m(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n)},n.config=function(e){return u=e,u.deps&&n(u.deps,u.callback),n},define=function(e,t,n){t.splice||(n=t,t=[]),!c(s,e)&&!c(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("requireLib",function(){}),function(){function r(){}function i(){}function s(e,t){this._loggers={},this.name=e||"",this._parent=t||null,t||(this._enabled=!0,this._level=n.WARN)}function o(){return t}function u(e){t=e}Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i});var e,t,n={DEBUG:10,INFO:20,WARN:30,ERROR:40,FATAL:50};r.prototype={output:function(e,t,r){if(typeof window.console=="undefined"||typeof console.log=="undefined")return;e&&r.unshift(e+":");var i=r.join(" ");if(typeof console.info===undefined){var s;t<=n.DEBUG?s="DEBUG":t<=n.INFO?s="INFO":t<=n.WARN?s="WARN":t<=n.ERROR?s="ERROR":s="FATAL",console.log("["+s+"] "+i)}else t<=n.DEBUG?(i="[DEBUG] "+i,console.log(i)):t<=n.INFO?console.info(i):t<=n.WARN?console.warn(i):console.error(i)}},i.prototype={output:function(e,t,r){e&&r.unshift(e+":"),t<=n.DEBUG?(r.unshift("[DEBUG]"),console.log.apply(console,r)):t<=n.INFO?console.info.apply(console,r):t<=n.WARN?console.warn.apply(console,r):console.error.apply(console,r)}},s.prototype={getLogger:function(e){var t=e.split("."),n=this,r=this.name?[this.name]:[];while(t.length){var i=t.shift();r.push(i),i in n._loggers||(n._loggers[i]=new s(r.join("."),n)),n=n._loggers[i]}return n},_getFlag:function(e){var t=this;e="_"+e;while(t!==null){if(t[e]!==undefined)return t[e];t=t._parent}return null},setEnabled:function(e){this._enabled=!!e},isEnabled:function(){this._getFlag("enabled")},setLevel:function(e){typeof e=="number"?this._level=e:typeof e=="string"&&(e=e.toUpperCase(),e in n&&(this._level=n[e]))},getLevel:function(){return this._getFlag("level")},log:function(e,n){if(!n.length||!this._getFlag("enabled")||e<this._getFlag("level"))return;n=Array.prototype.slice.call(n),t.output(this.name,e,n)},debug:function(){this.log(n.DEBUG,arguments)},info:function(){this.log(n.INFO,arguments)},warn:function(){this.log(n.WARN,arguments)},error:function(){this.log(n.ERROR,arguments)},fatal:function(){this.log(n.FATAL,arguments)}},window.console&&window.console.log&&window.console.log.apply!==undefined?u(new i):u(new r),e=new s;var a=/loglevel(|-[^=]+)=([^&]+)/g,f;while((f=a.exec(window.location.search))!==null){var l=f[1]===""?e:e.getLogger(f[1].slice(1));l.setLevel(f[2].toUpperCase())}var c={Level:n,getLogger:e.getLogger.bind(e),setEnabled:e.setEnabled.bind(e),isEnabled:e.isEnabled.bind(e),setLevel:e.setLevel.bind(e),getLevel:e.getLevel.bind(e),debug:e.debug.bind(e),info:e.info.bind(e),warn:e.warn.bind(e),error:e.error.bind(e),fatal:e.fatal.bind(e),getWriter:o,setWriter:u};typeof define=="function"?define("logging",[],function(){return c}):window.logging=c}(),define("logging/src/logging",function(){}),define("jam/Patterns/src/core/logger",["logging"],function(e){var t=e.getLogger("patterns");return t}),define("jam/Patterns/src/utils",["jquery"],function(e){function i(t){for(var n=t.parentNode;n&&n.nodeType!==11;n=n.parentNode)if(n.tagName==="LABEL")return n;var r;return t.id&&(r=e("label[for="+t.id+"]")),r&&r.length===0&&t.form&&(r=e("label[for="+t.name+"]",t.form)),r&&r.length?r[0]:null}function s(e){var t=e.getBoundingClientRect(),n=document.documentElement,r=window.innerWidth||n.clientWidth,i=window.innerHeight||n.clientHeight;return t.right<0||t.bottom<0||t.left>r||t.top>i?!1:!0}function o(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var t=function(t){var n=function(n){var r=this;if(r.length===0)return r;if(!n||typeof n=="object")t.init.apply(r,[r].concat(Array.prototype.slice.call(arguments)));else{if(t[n])return t[n].apply(r,[r].concat(Array.prototype.slice.call(arguments,1)));e.error("Method "+n+" does not exist on jQuery."+t.name)}return r};return n},n=function(e,t){var n;return function(){var r=this,i=arguments,s=function(){n=null,e.apply(r,i)};clearTimeout(n),n=setTimeout(s,t)}},r=function(e,t){return t.indexOf("://")!==-1||t[0]==="/"?t:e.slice(0,e.lastIndexOf("/")+1)+t},u={jquery_plugin:t,debounce:n,escapeRegExp:o,rebaseURL:r,findLabel:i,elementInViewport:s};return u}),define("jam/Patterns/src/jquery-ext",["jquery"],function(e){var t={init:function(n){var r={time:3,initialTime:8,exceptionAreas:[]};return this.each(function(){var i=e(this),s=i.data("timeout");s||(n&&e.extend(r,n),i.data("timeout",{lastEvent:new Date,trueTime:r.time,time:r.initialTime,untouched:!0,inExceptionArea:!1}),i.bind("mouseover.timeout",t.mouseMoved),i.bind("mouseenter.timeout",t.mouseMoved),e(r.exceptionAreas).each(function(){i.find(this).live("mouseover.timeout",{parent:i},t.enteredException).live("mouseleave.timeout",{parent:i},t.leftException)}),r.initialTime>0?i.timeout("startTimer"):i.addClass("timeout"))})},enteredException:function(e){var t=e.data.parent.data("timeout");t.inExceptionArea=!0,e.data.parent.data("timeout",t),e.data.parent.trigger("mouseover")},leftException:function(e){var t=e.data.parent.data("timeout");t.inExceptionArea=!1,e.data.parent.data("timeout",t)},destroy:function(){return this.each(function(){var t=e(this),n=t.data("timeout");e(window).unbind(".timeout"),n.timeout.remove(),t.removeData("timeout")})},mouseMoved:function(){var t=e(this),n=t.data("timeout");t.hasClass("timeout")?(t.removeClass("timeout"),t.timeout("startTimer")):n.untouched&&(n.untouched=!1,n.time=n.trueTime),n.lastEvent=new Date,t.data("timeout",n)},startTimer:function(){var t=e(this),n=t.data("timeout"),r=function(){var e=t.data("timeout");if(e&&e.lastEvent)if(e.inExceptionArea)setTimeout(r,Math.floor(e.time*1e3));else{var n=new Date,i=Math.floor(e.time*1e3)-(n-e.lastEvent);i>0?setTimeout(r,i+100):t.addClass("timeout")}};setTimeout(r,Math.floor(n.time*1e3))}};e.fn.timeout=function(n){if(t[n])return t[n].apply(this,Array.prototype.slice.call(arguments,1));if(typeof n=="object"||!n)return t.init.apply(this,arguments);e.error("Method "+n+" does not exist on jQuery.timeout")},e.extend(e.expr[":"],{scrollable:function(t){var n,r;return e(t).css("overflow")==="scroll"||e(t).css("overflowX")==="scroll"||e(t).css("overflowY")==="scroll"?!0:(n=t.clientHeight<t.scrollHeight&&(e.inArray(e(t).css("overflowY"),["scroll","auto"])!==-1||e.inArray(e(t).css("overflow"),["scroll","auto"])!==-1),n?!0:(r=t.clientWidth<t.scrollWidth&&(e.inArray(e(t).css("overflowX"),["scroll","auto"])!==-1||e.inArray(e(t).css("overflow"),["scroll","auto"])!==-1),r))}}),e.fn.makeVisibleInScroll=function(t){var n=null;return typeof t=="string"?n=e("#"+t):t&&(n=e(t)),this.each(function(){var t=e(this),r;n?r=n:(r=t.parents(":scrollable"),r.length>0?r=e(r[0]):r=e(window));var i=t.position().top,s=t.height()+i,o=r.scrollTop(),u=r.height()+o;i<o?r.scrollTop(i):s>u-r.height()/2&&r.scrollTop(i-(r.height()-t.height())/2)})},e.fn.setPositionAbsolute=function(t,n,r){return this.each(function(){var i=e(this),s=e(this).width(),o=t.offset(),u=t.width(),a=t.height(),f=o.left+u-s+r,l=o.top+a+n;i.css({"z-index":1,position:"absolute",marginLeft:0,marginTop:0,left:f+"px",top:l+"px",width:s}),i.remove().appendTo("body").show()})},e.fn.positionAncestor=function(t){var n=0,r=0;return this.each(function(){var i=e(this).closest(t);if(i.length&&i.css("position")!=="static"){var s=e(this),o=s.offset().left-parseInt(s.css("marginLeft"),10),u=s.offset().top-parseInt(s.css("marginTop"),10),a=i.offset().left+parseInt(i.css("borderLeftWidth"),10),f=i.offset().top+parseInt(i.css("borderTopWidth"),10);return n=o-a,r=u-f,!1}}),{left:n,top:r}},String.prototype.startsWith=function(e){return this.match("^"+e)!==null},String.prototype.endsWith=function(e){return this.match(e+"$")!==null},e.simplePlaceholder={placeholder_class:null,hide_placeholder:function(){var t=e(this);t.val()===t.attr("placeholder")&&t.val("").removeClass(e.simplePlaceholder.placeholder_class)},show_placeholder:function(){var t=e(this);t.val()===""&&t.val(t.attr("placeholder")).addClass(e.simplePlaceholder.placeholder_class)},prevent_placeholder_submit:function(){return e(this).find(".simple-placeholder").each(function(){var t=e(this);t.val()===t.attr("placeholder")&&t.val("")}),!0}},e.fn.simplePlaceholder=function(t){if(document.createElement("input").placeholder===undefined){var n={placeholder_class:"placeholding"};t&&e.extend(n,t),e.simplePlaceholder.placeholder_class=n.placeholder_class,this.each(function(){var t=e(this);t.focus(e.simplePlaceholder.hide_placeholder),t.blur(e.simplePlaceholder.show_placeholder),t.val()===""&&(t.val(t.attr("placeholder")),t.addClass(e.simplePlaceholder.placeholder_class)),t.addClass("simple-placeholder"),e(this.form).submit(e.simplePlaceholder.prevent_placeholder_submit)})}return this},e.fn.findInclusive=function(e){return this.find("*").addBack().filter(e)},e.expr[":"].Contains=function(t,n,r){return e(t).text().toUpperCase().indexOf(r[3].toUpperCase())>=0}}),define("jam/Patterns/src/compat",[],function(){Array.prototype.every||(Array.prototype.every=function(e){if(this===null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(typeof e!="function")throw new TypeError;var r=arguments[1];for(var i=0;i<n;i++)if(i in t&&!e.call(r,t[i],i,t))return!1;return!0}),Array.prototype.filter||(Array.prototype.filter=function(e){if(this===null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(typeof e!="function")throw new TypeError;var r=[],i=arguments[1];for(var s=0;s<n;s++)if(s in t){var o=t[s];e.call(i,o,s,t)&&r.push(o)}return r}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n,r;if(this===null)throw new TypeError(" this is null or not defined");var i=Object(this),s=i.length>>>0;if({}.toString.call(e)!=="[object Function]")throw new TypeError(e+" is not a function");t&&(n=t),r=0;while(r<s){var o;r in i&&(o=i[r],e.call(n,o,r,i)),r++}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(this===null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>0&&(r=Number(arguments[1]),r!==r?r=0:r!==0&&r!==Infinity&&r!==-Infinity&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(e){if(this===null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=n;arguments.length>1&&(r=Number(arguments[1]),r!==r?r=0:r!==0&&r!==1/0&&r!==-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r))));var i=r>=0?Math.min(r,n-1):n-Math.abs(r);for(;i>=0;i--)if(i in t&&t[i]===e)return i;return-1}),Array.prototype.map||(Array.prototype.map=function(e,t){var n,r,i;if(this===null)throw new TypeError(" this is null or not defined");var s=Object(this),o=s.length>>>0;if({}.toString.call(e)!=="[object Function]")throw new TypeError(e+" is not a function");t&&(n=t),r=new Array(o),i=0;while(i<o){var u,a;i in s&&(u=s[i],a=e.call(n,u,i,s),r[i]=a),i++}return r}),Array.prototype.reduce||(Array.prototype.reduce=function(t){if(this===null||this===undefined)throw new TypeError("Object is null or undefined");var n=0,r=this.length>>0,i;if(typeof t!="function")throw new TypeError("First argument is not callable");if(arguments.length<2){if(r===0)throw new TypeError("Array length is 0 and no second argument");i=this[0],n=1}else i=arguments[1];while(n<r)n in this&&(i=t.call(undefined,i,this[n],n,this)),++n;return i}),Array.prototype.reduceRight||(Array.prototype.reduceRight=function(e){if(this===null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(typeof e!="function")throw new TypeError;if(n===0&&arguments.length===1)throw new TypeError;var r=n-1,i;if(arguments.length>=2)i=arguments[1];else do{if(r in this){i=this[r--];break}if(--r<0)throw new TypeError}while(!0);while(r>=0)r in t&&(i=e.call(undefined,i,t[r],r,t)),r--;return i}),Array.prototype.some||(Array.prototype.some=function(e){if(this===null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(typeof e!="function")throw new TypeError;var r=arguments[1];for(var i=0;i<n;i++)if(i in t&&e.call(r,t[i],i,t))return!0;return!1}),Array.isArray||(Array.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i}),Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],r=n.length;return function(i){if(typeof i!="object"&&typeof i!="function"||i===null)throw new TypeError("Object.keys called on non-object");var s=[];for(var o in i)e.call(i,o)&&s.push(o);if(t)for(var u=0;u<r;u++)e.call(i,n[u])&&s.push(n[u]);return s}}())}),define("jam/Patterns/src/registry",["jquery","./core/logger","./utils","./jquery-ext","./compat"],function(e,t,n){var r=t.getLogger("registry"),i=n.jquery_plugin,s=/patterns-disable=([^&]+)/g,o={},u;while((u=s.exec(window.location.search))!==null)o[u[1]]=!0,r.info("Pattern disabled via url config:",u[1]);var a={patterns:{},initialized:!1,init:function(){e(document).ready(function(){r.info("loaded: "+Object.keys(a.patterns).sort().join(", ")),a.scan(document.body),a.initialized=!0,r.info("finished initial scan.")})},scan:function(n,i,s){var u=e(n),f=[],l,c,h,p;s=s||Object.keys(a.patterns),s.forEach(function(e){if(o[e]){r.debug("Skipping disabled pattern:",e);return}c=a.patterns[e];if(c.transform)try{c.transform(u)}catch(t){r.error("Transform error for pattern"+e,t)}c.trigger&&f.push(c.trigger)}),l=f.join(","),h=u.findInclusive(l),h=h.filter(function(){return e(this).parents("pre").length===0}),h=h.filter(":not(.cant-touch-this)"),h.toArray().reduceRight(function(n,r){var s=e(r);for(var o in a.patterns){c=a.patterns[o],p=t.getLogger("pat."+o);if(s.is(c.trigger)){p.debug("Initialising:",s);try{c.init(s),p.debug("done.")}catch(u){debugger;c.init(s);if(i)throw u;p.error("Caught error:",u)}}}},null)},register:function(t){if(!t.name)return r.error("Pattern lacks name:",t),!1;if(a.patterns[t.name])return r.error("Already have a pattern called: "+t.name),!1;a.patterns[t.name]=t;if(t.jquery_plugin){var n=("pat-"+t.name).replace(/-([a-zA-Z])/g,function(e,t){return t.toUpperCase()});e.fn[n]=i(t),e.fn[n.replace(/^pat/,"pattern")]=i(t)}return r.debug("Registered pattern:",t.name,t),a.initialized&&a.scan(document.body,!1,[t.name]),!0}};return e(document).on("patterns-injected.patterns",function(t){a.scan(t.target),e(t.target).trigger("patterns-injected-scanned")}),a}),define("js/patterns/base",["jquery","jam/Patterns/src/registry","jam/Patterns/src/core/logger"],function(e,t,n,r){function i(e){return e.replace(/\.(\w)/g,function(e,t){return t.toUpperCase()})}function s(e,t,n){if(t.length===1)return e[t[0]]=n;var r=t.shift();return e[r]||(e[r]={}),s(e[r],t,n)}function o(t,n,r){r=r||{},t.length!==0&&!e.nodeName(t[0],"body")&&(r=o(t.parent(),n,r));var i={};if(t.length!==0){i=t.data("pat-"+n);if(i&&typeof i=="string"){var u={};e.each(i.split(";"),function(e,t){t=t.split(":");if(t.length>=1){t.reverse();var n=t.pop();n=n.replace(/^\s+|\s+$/g,""),t.reverse();var r=t.join(":");r=r.replace(/^\s+|\s+$/g,""),u[n]=r}}),i={},e.each(u,function(e,t){s(i,e.split("-"),t)})}}return e.extend(!0,{},r,i)}var u=function(t,r){this.log=n.getLogger(this.name),this.$el=t,this.parser?this.options=e.extend(!0,{},this.parser.parse(t,this.defaults||{},this.multipleOptions||!1),r||{}):this.options=e.extend(!0,{},this.defaults||{},o(t,this.name),r||{}),this.init(),this.trigger("init")};return u.prototype={constructor:u,on:function(e,t){this.$el.on(e+"."+this.name+".patterns",t)},trigger:function(e){this.$el.trigger(e+"."+this.name+".patterns",[this])}},u.extend=function(n){var i=this,s;n&&n.hasOwnProperty("constructor")?s=n.constructor:s=function(){i.apply(this,arguments)};var o=function(){this.constructor=s};return o.prototype=i.prototype,s.prototype=new o,s.extend=i.extend,e.extend(!0,s.prototype,n),s.__super__=i.prototype,s.prototype.jqueryPlugin===r&&(s.prototype.jqueryPlugin="pattern"+s.prototype.name.charAt(0).toUpperCase()+s.prototype.name.slice(1)),s.prototype.jqueryPlugin&&(e.fn[s.prototype.jqueryPlugin]=function(t,n){return e(this).each(function(){var i=e(this),o=i.data("pattern-"+s.prototype.name);typeof t=="object"&&(n=t,t=r),!o||typeof o=="string"?(o=new s(i,n),i.data("pattern-"+s.prototype.name,o)):t&&o&&o[t]&&o[t].apply(o,[n])}),this}),t.register({name:s.prototype.name,trigger:".pat-"+s.prototype.name,jquery_plugin:!1,init:function(t){return t.each(function(t){var n=e(this),r=n.data("pattern-"+s.prototype.name+"-"+t);r||n.data("pattern-"+s.prototype.name+"-"+t,new s(n))})}}),s},u}),function(e){typeof e.fn.each2=="undefined"&&e.fn.extend({each2:function(t){var n=e([0]),r=-1,i=this.length;while(++r<i&&(n.context=n[0]=this[r])&&t.call(n[0],r,n)!==!1);return this}})}(jQuery),function(e,t){function h(e,t){var n=0,r=t.length;for(;n<r;n+=1)if(d(e,t[n]))return n;return-1}function p(){var t=e(c);t.appendTo("body");var n={width:t.width()-t[0].clientWidth,height:t.height()-t[0].clientHeight};return t.remove(),n}function d(e,n){return e===n?!0:e===t||n===t?!1:e===null||n===null?!1:e.constructor===String?e+""==n+"":n.constructor===String?n+""==e+"":!1}function v(t,n){var r,i,s;if(t===null||t.length<1)return[];r=t.split(n);for(i=0,s=r.length;i<s;i+=1)r[i]=e.trim(r[i]);return r}function m(e){return e.outerWidth(!1)-e.width()}function g(n){var r="keyup-change-value";n.on("keydown",function(){e.data(n,r)===t&&e.data(n,r,n.val())}),n.on("keyup",function(){var i=e.data(n,r);i!==t&&n.val()!==i&&(e.removeData(n,r),n.trigger("keyup-change"))})}function y(n){n.on("mousemove",function(n){var r=a;(r===t||r.x!==n.pageX||r.y!==n.pageY)&&e(n.target).trigger("mousemove-filtered",n)})}function b(e,n,r){r=r||t;var i;return function(){var t=arguments;window.clearTimeout(i),i=window.setTimeout(function(){n.apply(r,t)},e)}}function w(e){var t=!1,n;return function(){return t===!1&&(n=e(),t=!0),n}}function E(e,t){var n=b(e,function(e){t.trigger("scroll-debounced",e)});t.on("scroll",function(e){h(e.target,t.get())>=0&&n(e)})}function S(e){if(e[0]===document.activeElement)return;window.setTimeout(function(){var t=e[0],n=e.val().length,r;e.focus(),e.is(":visible")&&t===document.activeElement&&(t.setSelectionRange?t.setSelectionRange(n,n):t.createTextRange&&(r=t.createTextRange(),r.collapse(!1),r.select()))},0)}function x(t){t=e(t)[0];var n=0,r=0;if("selectionStart"in t)n=t.selectionStart,r=t.selectionEnd-n;else if("selection"in document){t.focus();var i=document.selection.createRange();r=document.selection.createRange().text.length,i.moveStart("character",-t.value.length),n=i.text.length-r}return{offset:n,length:r}}function T(e){e.preventDefault(),e.stopPropagation()}function N(e){e.preventDefault(),e.stopImmediatePropagation()}function C(t){if(!u){var n=t[0].currentStyle||window.getComputedStyle(t[0],null);u=e(document.createElement("div")).css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:n.fontSize,fontFamily:n.fontFamily,fontStyle:n.fontStyle,fontWeight:n.fontWeight,letterSpacing:n.letterSpacing,textTransform:n.textTransform,whiteSpace:"nowrap"}),u.attr("class","select2-sizer"),e("body").append(u)}return u.text(t.val()),u.width()}function k(t,n,r){var i,s=[],o;i=t.attr("class"),i&&(i=""+i,e(i.split(" ")).each2(function(){this.indexOf("select2-")===0&&s.push(this)})),i=n.attr("class"),i&&(i=""+i,e(i.split(" ")).each2(function(){this.indexOf("select2-")!==0&&(o=r(this),o&&s.push(this))})),t.attr("class",s.join(" "))}function L(e,t,n,r){var i=e.toUpperCase().indexOf(t.toUpperCase()),s=t.length;if(i<0){n.push(r(e));return}n.push(r(e.substring(0,i))),n.push("<span class='select2-match'>"),n.push(r(e.substring(i,i+s))),n.push("</span>"),n.push(r(e.substring(i+s,e.length)))}function A(n){var r,i=0,s=null,o=n.quietMillis||100,u=n.url,a=this;return function(f){window.clearTimeout(r),r=window.setTimeout(function(){i+=1;var r=i,o=n.data,l=u,c=n.transport||e.fn.select2.ajaxDefaults.transport,h={type:n.type||"GET",cache:n.cache||!1,jsonpCallback:n.jsonpCallback||t,dataType:n.dataType||"json"},p=e.extend({},e.fn.select2.ajaxDefaults.params,h);o=o?o.call(a,f.term,f.page,f.context):null,l=typeof l=="function"?l.call(a,f.term,f.page,f.context):l,null!==s&&s.abort(),n.params&&(e.isFunction(n.params)?e.extend(p,n.params.call(a)):e.extend(p,n.params)),e.extend(p,{url:l,dataType:n.dataType,data:o,success:function(e){if(r<i)return;var t=n.results(e,f.page);f.callback(t)}}),s=c.call(a,p)},o)}}function O(t){var n=t,r,i,s=function(e){return""+e.text};e.isArray(n)&&(i=n,n={results:i}),e.isFunction(n)===!1&&(i=n,n=function(){return i});var o=n();return o.text&&(s=o.text,e.isFunction(s)||(r=o.text,s=function(e){return e[r]})),function(t){var r=t.term,i={results:[]},o;if(r===""){t.callback(n());return}o=function(n,i){var u,a;n=n[0];if(n.children){u={};for(a in n)n.hasOwnProperty(a)&&(u[a]=n[a]);u.children=[],e(n.children).each2(function(e,t){o(t,u.children)}),(u.children.length||t.matcher(r,s(u),n))&&i.push(u)}else t.matcher(r,s(n),n)&&i.push(n)},e(n().results).each2(function(e,t){o(t,i.results)}),t.callback(i)}}function M(n){var r=e.isFunction(n);return function(i){var s=i.term,o={results:[]};e(r?n():n).each(function(){var e=this.text!==t,n=e?this.text:this;(s===""||i.matcher(s,n))&&o.results.push(e?this:{id:this,text:this})}),i.callback(o)}}function _(t,n){if(e.isFunction(t))return!0;if(!t)return!1;throw new Error("formatterName must be a function or a falsy value")}function D(t){return e.isFunction(t)?t():t}function P(t){var n=0;return e.each(t,function(e,t){t.children?n+=P(t.children):n++}),n}function H(e,n,r,i){var s=e,o=!1,u,a,f,l,c;if(!i.createSearchChoice||!i.tokenSeparators||i.tokenSeparators.length<1)return t;for(;;){a=-1;for(f=0,l=i.tokenSeparators.length;f<l;f++){c=i.tokenSeparators[f],a=e.indexOf(c);if(a>=0)break}if(a<0)break;u=e.substring(0,a),e=e.substring(a+c.length);if(u.length>0){u=i.createSearchChoice(u,n);if(u!==t&&u!==null&&i.id(u)!==t&&i.id(u)!==null){o=!1;for(f=0,l=n.length;f<l;f++)if(d(i.id(u),i.id(n[f]))){o=!0;break}o||r(u)}}}if(s!==e)return e}function B(t,n){var r=function(){};return r.prototype=new t,r.prototype.constructor=r,r.prototype.parent=t.prototype,r.prototype=e.extend(r.prototype,n),r}if(window.Select2!==t)return;var n,r,i,s,o,u,a,f,l,n={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(e){e=e.which?e.which:e;switch(e){case n.LEFT:case n.RIGHT:case n.UP:case n.DOWN:return!0}return!1},isControl:function(e){var t=e.which;switch(t){case n.SHIFT:case n.CTRL:case n.ALT:return!0}return e.metaKey?!0:!1},isFunctionKey:function(e){return e=e.which?e.which:e,e>=112&&e<=123}},c="<div class='select2-measure-scrollbar'></div>";f=e(document),o=function(){var e=1;return function(){return e++}}(),f.on("mousemove",function(e){a={x:e.pageX,y:e.pageY}}),r=B(Object,{bind:function(e){var t=this;return function(){e.apply(t,arguments)}},init:function(n){var r,i,s=".select2-results",u,a;this.opts=n=this.prepareOpts(n),this.id=n.id,n.element.data("select2")!==t&&n.element.data("select2")!==null&&this.destroy(),this.container=this.createContainer(),this.containerId="s2id_"+(n.element.attr("id")||"autogen"+o()),this.containerSelector="#"+this.containerId.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1"),this.container.attr("id",this.containerId),this.body=w(function(){return n.element.closest("body")}),k(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.css(D(n.containerCss)),this.container.addClass(D(n.containerCssClass)),this.elementTabIndex=this.opts.element.attr("tabindex"),this.opts.element.data("select2",this).attr("tabindex","-1").before(this.container),this.container.data("select2",this),this.dropdown=this.container.find(".select2-drop"),this.dropdown.addClass(D(n.dropdownCssClass)),this.dropdown.data("select2",this),this.results=r=this.container.find(s),this.search=i=this.container.find("input.select2-input"),this.resultsPage=0,this.context=null,this.initContainer(),y(this.results),this.dropdown.on("mousemove-filtered touchstart touchmove touchend",s,this.bind(this.highlightUnderEvent)),E(80,this.results),this.dropdown.on("scroll-debounced",s,this.bind(this.loadMoreIfNeeded)),e(this.container).on("change",".select2-input",function(e){e.stopPropagation()}),e(this.dropdown).on("change",".select2-input",function(e){e.stopPropagation()}),e.fn.mousewheel&&r.mousewheel(function(e,t,n,i){var s=r.scrollTop(),o;i>0&&s-i<=0?(r.scrollTop(0),T(e)):i<0&&r.get(0).scrollHeight-r.scrollTop()+i<=r.height()&&(r.scrollTop(r.get(0).scrollHeight-r.height()),T(e))}),g(i),i.on("keyup-change input paste",this.bind(this.updateResults)),i.on("focus",function(){i.addClass("select2-focused")}),i.on("blur",function(){i.removeClass("select2-focused")}),this.dropdown.on("mouseup",s,this.bind(function(t){e(t.target).closest(".select2-result-selectable").length>0&&(this.highlightUnderEvent(t),this.selectHighlighted(t))})),this.dropdown.on("click mouseup mousedown",function(e){e.stopPropagation()}),e.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource()),n.maximumInputLength!==null&&this.search.attr("maxlength",n.maximumInputLength);var u=n.element.prop("disabled");u===t&&(u=!1),this.enable(!u);var a=n.element.prop("readonly");a===t&&(a=!1),this.readonly(a),l=l||p(),this.autofocus=n.element.prop("autofocus"),n.element.prop("autofocus",!1),this.autofocus&&this.focus()},destroy:function(){var e=this.opts.element.data("select2");this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),e!==t&&(e.container.remove(),e.dropdown.remove(),e.opts.element.removeClass("select2-offscreen").removeData("select2").off(".select2").attr({tabindex:this.elementTabIndex}).prop("autofocus",this.autofocus||!1).show())},optionToData:function(e){if(e.is("option"))return{id:e.prop("value"),text:e.text(),element:e.get(),css:e.attr("class"),disabled:e.prop("disabled"),locked:d(e.attr("locked"),"locked")};if(e.is("optgroup"))return{text:e.attr("label"),children:[],element:e.get(),css:e.attr("class")}},prepareOpts:function(n){var r,i,s,o,u=this;r=n.element,r.get(0).tagName.toLowerCase()==="select"&&(this.select=i=n.element),i&&e.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in n)throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")}),n=e.extend({},{populateResults:function(r,i,s){var o,a,f,l,c=this.opts.id;o=function(r,i,a){var f,l,h,p,d,v,m,g,y,b;r=n.sortResults(r,i,s);for(f=0,l=r.length;f<l;f+=1)h=r[f],d=h.disabled===!0,p=!d&&c(h)!==t,v=h.children&&h.children.length>0,m=e("<li></li>"),m.addClass("select2-results-dept-"+a),m.addClass("select2-result"),m.addClass(p?"select2-result-selectable":"select2-result-unselectable"),d&&m.addClass("select2-disabled"),v&&m.addClass("select2-result-with-children"),m.addClass(u.opts.formatResultCssClass(h)),g=e(document.createElement("div")),g.addClass("select2-result-label"),b=n.formatResult(h,g,s,u.opts.escapeMarkup),b!==t&&g.html(b),m.append(g),v&&(y=e("<ul></ul>"),y.addClass("select2-result-sub"),o(h.children,y,a+1),m.append(y)),m.data("select2-data",h),i.append(m)},o(i,r,0)}},e.fn.select2.defaults,n),typeof n.id!="function"&&(s=n.id,n.id=function(e){return e[s]});if(e.isArray(n.element.data("select2Tags"))){if("tags"in n)throw"tags specified as both an attribute 'data-select2-tags' and in options of Select2 "+n.element.attr("id");n.tags=n.element.data("select2Tags")}i?(n.query=this.bind(function(n){var i={results:[],more:!1},s=n.term,o,a,f;f=function(e,t){var r;e.is("option")?n.matcher(s,e.text(),e)&&t.push(u.optionToData(e)):e.is("optgroup")&&(r=u.optionToData(e),e.children().each2(function(e,t){f(t,r.children)}),r.children.length>0&&t.push(r))},o=r.children(),this.getPlaceholder()!==t&&o.length>0&&(a=o[0],e(a).text()===""&&(o=o.not(a))),o.each2(function(e,t){f(t,i.results)}),n.callback(i)}),n.id=function(e){return e.id},n.formatResultCssClass=function(e){return e.css}):"query"in n||("ajax"in n?(o=n.element.data("ajax-url"),o&&o.length>0&&(n.ajax.url=o),n.query=A.call(n.element,n.ajax)):"data"in n?n.query=O(n.data):"tags"in n&&(n.query=M(n.tags),n.createSearchChoice===t&&(n.createSearchChoice=function(e){return{id:e,text:e}}),n.initSelection===t&&(n.initSelection=function(t,r){var i=[];e(v(t.val(),n.separator)).each(function(){var t=this,r=this,s=n.tags;e.isFunction(s)&&(s=s()),e(s).each(function(){if(d(this.id,t))return r=this.text,!1}),i.push({id:t,text:r})}),r(i)})));if(typeof n.query!="function")throw"query function not defined for Select2 "+n.element.attr("id");return n},monitorSource:function(){var e=this.opts.element,n;e.on("change.select2",this.bind(function(e){this.opts.element.data("select2-change-triggered")!==!0&&this.initSelection()})),n=this.bind(function(){var n,r,i=this,s=e.prop("disabled");s===t&&(s=!1),this.enable(!s);var r=e.prop("readonly");r===t&&(r=!1),this.readonly(r),k(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.addClass(D(this.opts.containerCssClass)),k(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass(D(this.opts.dropdownCssClass))}),e.on("propertychange.select2 DOMAttrModified.select2",n),this.mutationCallback===t&&(this.mutationCallback=function(e){e.forEach(n)}),typeof WebKitMutationObserver!="undefined"&&(this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),this.propertyObserver=new WebKitMutationObserver(this.mutationCallback),this.propertyObserver.observe(e.get(0),{attributes:!0,subtree:!1}))},triggerSelect:function(t){var n=e.Event("select2-selecting",{val:this.id(t),object:t});return this.opts.element.trigger(n),!n.isDefaultPrevented()},triggerChange:function(t){t=t||{},t=e.extend({},t,{type:"change",val:this.val()}),this.opts.element.data("select2-change-triggered",!0),this.opts.element.trigger(t),this.opts.element.data("select2-change-triggered",!1),this.opts.element.click(),this.opts.blurOnChange&&this.opts.element.blur()},isInterfaceEnabled:function(){return this.enabledInterface===!0},enableInterface:function(){var e=this._enabled&&!this._readonly,t=!e;return e===this.enabledInterface?!1:(this.container.toggleClass("select2-container-disabled",t),this.close(),this.enabledInterface=e,!0)},enable:function(e){return e===t&&(e=!0),this._enabled===e?!1:(this._enabled=e,this.opts.element.prop("disabled",!e),this.enableInterface(),!0)},readonly:function(e){return e===t&&(e=!1),this._readonly===e?!1:(this._readonly=e,this.opts.element.prop("readonly",e),this.enableInterface(),!0)},opened:function(){return this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var t=this.dropdown,n=this.container.offset(),r=this.container.outerHeight(!1),i=this.container.outerWidth(!1),s=t.outerHeight(!1),o=e(window).scrollLeft()+e(window).width(),u=e(window).scrollTop()+e(window).height(),a=n.top+r,f=n.left,c=a+s<=u,h=n.top-s>=this.body().scrollTop(),p=t.outerWidth(!1),d=f+p<=o,v=t.hasClass("select2-drop-above"),m,g,y,b;this.opts.dropdownAutoWidth?(b=e(".select2-results",t)[0],t.addClass("select2-drop-auto-width"),t.css("width",""),p=t.outerWidth(!1)+(b.scrollHeight===b.clientHeight?0:l.width),p>i?i=p:p=i,d=f+p<=o):this.container.removeClass("select2-drop-auto-width"),this.body().css("position")!=="static"&&(m=this.body().offset(),a-=m.top,f-=m.left),v?(g=!0,!h&&c&&(g=!1)):(g=!1,!c&&h&&(g=!0)),d||(f=n.left+i-p),g?(a=n.top-s,this.container.addClass("select2-drop-above"),t.addClass("select2-drop-above")):(this.container.removeClass("select2-drop-above"),t.removeClass("select2-drop-above")),y=e.extend({top:a,left:f,width:i},D(this.opts.dropdownCss)),t.css(y)},shouldOpen:function(){var t;return this.opened()?!1:this._enabled===!1||this._readonly===!0?!1:(t=e.Event("select2-opening"),this.opts.element.trigger(t),!t.isDefaultPrevented())},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")},open:function(){return this.shouldOpen()?(this.opening(),!0):!1},opening:function(){function u(){return{width:Math.max(document.documentElement.scrollWidth,e(window).width()),height:Math.max(document.documentElement.scrollHeight,e(window).height())}}var t=this.containerId,n="scroll."+t,r="resize."+t,i="orientationchange."+t,s;this.container.addClass("select2-dropdown-open").addClass("select2-container-active"),this.clearDropdownAlignmentPreference(),this.dropdown[0]!==this.body().children().last()[0]&&this.dropdown.detach().appendTo(this.body()),s=e("#select2-drop-mask"),s.length==0&&(s=e(document.createElement("div")),s.attr("id","select2-drop-mask").attr("class","select2-drop-mask"),s.hide(),s.appendTo(this.body()),s.on("mousedown touchstart",function(t){var n=e("#select2-drop"),r;n.length>0&&(r=n.data("select2"),r.opts.selectOnBlur&&r.selectHighlighted({noFocus:!0}),r.close(),t.preventDefault(),t.stopPropagation())})),this.dropdown.prev()[0]!==s[0]&&this.dropdown.before(s),e("#select2-drop").removeAttr("id"),this.dropdown.attr("id","select2-drop"),s.css(u()),s.show(),this.dropdown.show(),this.positionDropdown(),this.dropdown.addClass("select2-drop-active"),this.ensureHighlightVisible();var o=this;this.container.parents().add(window).each(function(){e(this).on(r+" "+n+" "+i,function(t){e("#select2-drop-mask").css(u()),o.positionDropdown()})})},close:function(){if(!this.opened())return;var t=this.containerId,n="scroll."+t,r="resize."+t,i="orientationchange."+t;this.container.parents().add(window).each(function(){e(this).off(n).off(r).off(i)}),this.clearDropdownAlignmentPreference(),e("#select2-drop-mask").hide(),this.dropdown.removeAttr("id"),this.dropdown.hide(),this.container.removeClass("select2-dropdown-open"),this.results.empty(),this.clearSearch(),this.search.removeClass("select2-active"),this.opts.element.trigger(e.Event("select2-close"))},clearSearch:function(){},getMaximumSelectionSize:function(){return D(this.opts.maximumSelectionSize)},ensureHighlightVisible:function(){var t=this.results,n,r,i,s,o,u,a;r=this.highlight();if(r<0)return;if(r==0){t.scrollTop(0);return}n=this.findHighlightableChoices().find(".select2-result-label"),i=e(n[r]),s=i.offset().top+i.outerHeight(!0),r===n.length-1&&(a=t.find("li.select2-more-results"),a.length>0&&(s=a.offset().top+a.outerHeight(!0))),o=t.offset().top+t.outerHeight(!0),s>o&&t.scrollTop(t.scrollTop()+(s-o)),u=i.offset().top-t.offset().top,u<0&&i.css("display")!="none"&&t.scrollTop(t.scrollTop()+u)},findHighlightableChoices:function(){return this.results.find(".select2-result-selectable:not(.select2-selected):not(.select2-disabled)")},moveHighlight:function(t){var n=this.findHighlightableChoices(),r=this.highlight();while(r>-1&&r<n.length){r+=t;var i=e(n[r]);if(i.hasClass("select2-result-selectable")&&!i.hasClass("select2-disabled")&&!i.hasClass("select2-selected")){this.highlight(r);break}}},highlight:function(t){var n=this.findHighlightableChoices(),r,i;if(arguments.length===0)return h(n.filter(".select2-highlighted")[0],n.get());t>=n.length&&(t=n.length-1),t<0&&(t=0),this.results.find(".select2-highlighted").removeClass("select2-highlighted"),r=e(n[t]),r.addClass("select2-highlighted"),this.ensureHighlightVisible(),i=r.data("select2-data"),i&&this.opts.element.trigger({type:"select2-highlight",val:this.id(i),choice:i})},countSelectableResults:function(){return this.findHighlightableChoices().length},highlightUnderEvent:function(t){var n=e(t.target).closest(".select2-result-selectable");if(n.length>0&&!n.is(".select2-highlighted")){var r=this.findHighlightableChoices();this.highlight(r.index(n))}else n.length==0&&this.results.find(".select2-highlighted").removeClass("select2-highlighted")},loadMoreIfNeeded:function(){var e=this.results,t=e.find("li.select2-more-results"),n,r=-1,i=this.resultsPage+1,s=this,o=this.search.val(),u=this.context;if(t.length===0)return;n=t.offset().top-e.offset().top-e.height(),n<=this.opts.loadMorePadding&&(t.addClass("select2-active"),this.opts.query({element:this.opts.element,term:o,page:i,context:u,matcher:this.opts.matcher,callback:this.bind(function(n){if(!s.opened())return;s.opts.populateResults.call(this,e,n.results,{term:o,page:i,context:u}),s.postprocessResults(n,!1,!1),n.more===!0?(t.detach().appendTo(e).text(s.opts.formatLoadMore(i+1)),window.setTimeout(function(){s.loadMoreIfNeeded()},10)):t.remove(),s.positionDropdown(),s.resultsPage=i,s.context=n.context})}))},tokenize:function(){},updateResults:function(n){function c(){i.scrollTop(0),r.removeClass("select2-active"),u.positionDropdown()}function h(e){i.html(e),c()}var r=this.search,i=this.results,s=this.opts,o,u=this,a,f=r.val(),l=e.data(this.container,"select2-last-term");if(n!==!0&&l&&d(f,l))return;e.data(this.container,"select2-last-term",f);if(n!==!0&&(this.showSearchInput===!1||!this.opened()))return;var p=this.getMaximumSelectionSize();if(p>=1){o=this.data();if(e.isArray(o)&&o.length>=p&&_(s.formatSelectionTooBig,"formatSelectionTooBig")){h("<li class='select2-selection-limit'>"+s.formatSelectionTooBig(p)+"</li>");return}}if(r.val().length<s.minimumInputLength){_(s.formatInputTooShort,"formatInputTooShort")?h("<li class='select2-no-results'>"+s.formatInputTooShort(r.val(),s.minimumInputLength)+"</li>"):h(""),n&&this.showSearch(!0);return}if(s.maximumInputLength&&r.val().length>s.maximumInputLength){_(s.formatInputTooLong,"formatInputTooLong")?h("<li class='select2-no-results'>"+s.formatInputTooLong(r.val(),s.maximumInputLength)+"</li>"):h("");return}s.formatSearching&&this.findHighlightableChoices().length===0&&h("<li class='select2-searching'>"+s.formatSearching()+"</li>"),r.addClass("select2-active"),a=this.tokenize(),a!=t&&a!=null&&r.val(a),this.resultsPage=1,s.query({element:s.element,term:r.val(),page:this.resultsPage,context:null,matcher:s.matcher,callback:this.bind(function(o){var a;if(!this.opened()){this.search.removeClass("select2-active");return}this.context=o.context===t?null:o.context,this.opts.createSearchChoice&&r.val()!==""&&(a=this.opts.createSearchChoice.call(null,r.val(),o.results),a!==t&&a!==null&&u.id(a)!==t&&u.id(a)!==null&&e(o.results).filter(function(){return d(u.id(this),u.id(a))}).length===0&&o.results.unshift(a));if(o.results.length===0&&_(s.formatNoMatches,"formatNoMatches")){h("<li class='select2-no-results'>"+s.formatNoMatches(r.val())+"</li>");return}i.empty(),u.opts.populateResults.call(this,i,o.results,{term:r.val(),page:this.resultsPage,context:null}),o.more===!0&&_(s.formatLoadMore,"formatLoadMore")&&(i.append("<li class='select2-more-results'>"+u.opts.escapeMarkup(s.formatLoadMore(this.resultsPage))+"</li>"),window.setTimeout(function(){u.loadMoreIfNeeded()},10)),this.postprocessResults(o,n),c(),this.opts.element.trigger({type:"select2-loaded",data:o})})})},cancel:function(){this.close()},blur:function(){this.opts.selectOnBlur&&this.selectHighlighted({noFocus:!0}),this.close(),this.container.removeClass("select2-container-active"),this.search[0]===document.activeElement&&this.search.blur(),this.clearSearch(),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")},focusSearch:function(){S(this.search)},selectHighlighted:function(e){var t=this.highlight(),n=this.results.find(".select2-highlighted"),r=n.closest(".select2-result").data("select2-data");r&&(this.highlight(t),this.onSelect(r,e))},getPlaceholder:function(){return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder},initContainerWidth:function(){function n(){var n,r,i,s,o;if(this.opts.width==="off")return null;if(this.opts.width==="element")return this.opts.element.outerWidth(!1)===0?"auto":this.opts.element.outerWidth(!1)+"px";if(this.opts.width==="copy"||this.opts.width==="resolve"){n=this.opts.element.attr("style");if(n!==t){r=n.split(";");for(s=0,o=r.length;s<o;s+=1){i=r[s].replace(/\s/g,"").match(/width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i);if(i!==null&&i.length>=1)return i[1]}}return n=this.opts.element.css("width"),n&&n.length>0?n:this.opts.width==="resolve"?this.opts.element.outerWidth(!1)===0?"auto":this.opts.element.outerWidth(!1)+"px":null}return e.isFunction(this.opts.width)?this.opts.width():this.opts.width}var r=n.call(this);r!==null&&this.container.css("width",r)}}),i=B(r,{createContainer:function(){var t=e(document.createElement("div")).attr({"class":"select2-container"}).html(["<a href='javascript:void(0)' onclick='return false;' class='select2-choice' tabindex='-1'>","   <span>&nbsp;</span><abbr class='select2-search-choice-close'></abbr>","   <div><b></b></div>","</a>","<input class='select2-focusser select2-offscreen' type='text'/>","<div class='select2-drop select2-display-none'>","   <div class='select2-search'>","       <input type='text' autocomplete='off' autocorrect='off' autocapitilize='off' spellcheck='false' class='select2-input'/>","   </div>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return t},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.focusser.prop("disabled",!this.isInterfaceEnabled())},opening:function(){var t,n;this.parent.opening.apply(this,arguments),this.showSearchInput!==!1&&this.search.val(this.focusser.val()),this.search.focus(),t=this.search.get(0),t.createTextRange&&(n=t.createTextRange(),n.collapse(!1),n.select()),this.focusser.prop("disabled",!0).val(""),this.updateResults(!0),this.opts.element.trigger(e.Event("select2-open"))},close:function(){if(!this.opened())return;this.parent.close.apply(this,arguments),this.focusser.removeAttr("disabled"),this.focusser.focus()},focus:function(){this.opened()?this.close():(this.focusser.removeAttr("disabled"),this.focusser.focus())},isFocused:function(){return this.container.hasClass("select2-container-active")},cancel:function(){this.parent.cancel.apply(this,arguments),this.focusser.removeAttr("disabled"),this.focusser.focus()},initContainer:function(){var t,r=this.container,i=this.dropdown;this.showSearch(!1),this.selection=t=r.find(".select2-choice"),this.focusser=r.find(".select2-focusser"),this.focusser.attr("id","s2id_autogen"+o()),e("label[for='"+this.opts.element.attr("id")+"']").attr("for",this.focusser.attr("id")),this.focusser.attr("tabindex",this.elementTabIndex),this.search.on("keydown",this.bind(function(e){if(!this.isInterfaceEnabled())return;if(e.which===n.PAGE_UP||e.which===n.PAGE_DOWN){T(e);return}switch(e.which){case n.UP:case n.DOWN:this.moveHighlight(e.which===n.UP?-1:1),T(e);return;case n.ENTER:this.selectHighlighted(),T(e);return;case n.TAB:this.selectHighlighted({noFocus:!0});return;case n.ESC:this.cancel(e),T(e);return}})),this.search.on("blur",this.bind(function(e){document.activeElement===this.body().get(0)&&window.setTimeout(this.bind(function(){this.search.focus()}),0)})),this.focusser.on("keydown",this.bind(function(e){if(!this.isInterfaceEnabled())return;if(e.which===n.TAB||n.isControl(e)||n.isFunctionKey(e)||e.which===n.ESC)return;if(this.opts.openOnEnter===!1&&e.which===n.ENTER){T(e);return}if(e.which==n.DOWN||e.which==n.UP||e.which==n.ENTER&&this.opts.openOnEnter){this.open(),T(e);return}if(e.which==n.DELETE||e.which==n.BACKSPACE){this.opts.allowClear&&this.clear(),T(e);return}})),g(this.focusser),this.focusser.on("keyup-change input",this.bind(function(e){e.stopPropagation();if(this.opened())return;this.open()})),t.on("mousedown","abbr",this.bind(function(e){if(!this.isInterfaceEnabled())return;this.clear(),N(e),this.close(),this.selection.focus()})),t.on("mousedown",this.bind(function(t){this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.opened()?this.close():this.isInterfaceEnabled()&&this.open(),T(t)})),i.on("mousedown",this.bind(function(){this.search.focus()})),t.on("focus",this.bind(function(e){T(e)})),this.focusser.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.container.addClass("select2-container-active")})).on("blur",this.bind(function(){this.opened()||(this.container.removeClass("select2-container-active"),this.opts.element.trigger(e.Event("select2-blur")))})),this.search.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.container.addClass("select2-container-active")})),this.initContainerWidth(),this.opts.element.addClass("select2-offscreen"),this.setPlaceholder()},clear:function(e){var t=this.selection.data("select2-data");t&&(this.opts.element.val(""),this.selection.find("span").empty(),this.selection.removeData("select2-data"),this.setPlaceholder(),e!==!1&&(this.opts.element.trigger({type:"select2-removed",val:this.id(t),choice:t}),this.triggerChange({removed:t})))},initSelection:function(){var e;if(this.opts.element.val()===""&&this.opts.element.text()==="")this.updateSelection([]),this.close(),this.setPlaceholder();else{var n=this;this.opts.initSelection.call(null,this.opts.element,function(e){e!==t&&e!==null&&(n.updateSelection(e),n.close(),n.setPlaceholder())})}},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments),n=this;return t.element.get(0).tagName.toLowerCase()==="select"?t.initSelection=function(e,t){var r=e.find(":selected");t(n.optionToData(r))}:"data"in t&&(t.initSelection=t.initSelection||function(n,r){var i=n.val(),s=null;t.query({matcher:function(e,n,r){var o=d(i,t.id(r));return o&&(s=r),o},callback:e.isFunction(r)?function(){r(s)}:e.noop})}),t},getPlaceholder:function(){return this.select&&this.select.find("option").first().text()!==""?t:this.parent.getPlaceholder.apply(this,arguments)},setPlaceholder:function(){var e=this.getPlaceholder();if(this.opts.element.val()===""&&e!==t){if(this.select&&this.select.find("option:first").text()!=="")return;this.selection.find("span").html(this.opts.escapeMarkup(e)),this.selection.addClass("select2-default"),this.container.removeClass("select2-allowclear")}},postprocessResults:function(e,t,n){var r=0,i=this,s=!0;this.findHighlightableChoices().each2(function(e,t){if(d(i.id(t.data("select2-data")),i.opts.element.val()))return r=e,!1}),n!==!1&&this.highlight(r);if(t===!0&&this.showSearchInput===!1){var o=this.opts.minimumResultsForSearch;o>=0&&this.showSearch(P(e.results)>=o)}},showSearch:function(t){this.showSearchInput=t,this.dropdown.find(".select2-search").toggleClass("select2-search-hidden",!t),this.dropdown.find(".select2-search").toggleClass("select2-offscreen",!t),e(this.dropdown,this.container).toggleClass("select2-with-searchbox",t)},onSelect:function(e,t){if(!this.triggerSelect(e))return;var n=this.opts.element.val(),r=this.data();this.opts.element.val(this.id(e)),this.updateSelection(e),this.opts.element.trigger({type:"select2-selected",val:this.id(e),choice:e}),this.close(),(!t||!t.noFocus)&&this.selection.focus(),d(n,this.id(e))||this.triggerChange({added:e,removed:r})},updateSelection:function(e){var n=this.selection.find("span"),r;this.selection.data("select2-data",e),n.empty(),r=this.opts.formatSelection(e,n),r!==t&&n.append(this.opts.escapeMarkup(r)),this.selection.removeClass("select2-default"),this.opts.allowClear&&this.getPlaceholder()!==t&&this.container.addClass("select2-allowclear")},val:function(){var e,n=!1,r=null,i=this,s=this.data();if(arguments.length===0)return this.opts.element.val();e=arguments[0],arguments.length>1&&(n=arguments[1]);if(this.select)this.select.val(e).find(":selected").each2(function(e,t){return r=i.optionToData(t),!1}),this.updateSelection(r),this.setPlaceholder(),n&&this.triggerChange({added:r,removed:s});else{if(this.opts.initSelection===t)throw new Error("cannot call val() if initSelection() is not defined");if(!e&&e!==0){this.clear(n);return}this.opts.element.val(e),this.opts.initSelection(this.opts.element,function(e){i.opts.element.val(e?i.id(e):""),i.updateSelection(e),i.setPlaceholder(),n&&i.triggerChange({added:e,removed:s})})}},clearSearch:function(){this.search.val(""),this.focusser.val("")},data:function(e,n){var r;if(arguments.length===0)return r=this.selection.data("select2-data"),r==t&&(r=null),r;!e||e===""?this.clear(n):(r=this.data(),this.opts.element.val(e?this.id(e):""),this.updateSelection(e),n&&this.triggerChange({added:e,removed:r}))}}),s=B(r,{createContainer:function(){var t=e(document.createElement("div")).attr({"class":"select2-container select2-container-multi"}).html(["    <ul class='select2-choices'>","  <li class='select2-search-field'>","    <input type='text' autocomplete='off' autocorrect='off' autocapitilize='off' spellcheck='false' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi select2-display-none'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return t},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments),n=this;return t.element.get(0).tagName.toLowerCase()==="select"?t.initSelection=function(e,t){var r=[];e.find(":selected").each2(function(e,t){r.push(n.optionToData(t))}),t(r)}:"data"in t&&(t.initSelection=t.initSelection||function(n,r){var i=v(n.val(),t.separator),s=[];t.query({matcher:function(n,r,o){var u=e.grep(i,function(e){return d(e,t.id(o))}).length;return u&&s.push(o),u},callback:e.isFunction(r)?function(){var e=[];for(var n=0;n<i.length;n++){var o=i[n];for(var u=0;u<s.length;u++){var a=s[u];if(d(o,t.id(a))){e.push(a),s.splice(u,1);break}}}r(e)}:e.noop})}),t},selectChoice:function(e){var t=this.container.find(".select2-search-choice-focus");if(!t.length||!e||e[0]!=t[0])t.length&&this.opts.element.trigger("choice-deselected",t),t.removeClass("select2-search-choice-focus"),e&&e.length&&(this.close(),e.addClass("select2-search-choice-focus"),this.opts.element.trigger("choice-selected",e))},initContainer:function(){var t=".select2-choices",r;this.searchContainer=this.container.find(".select2-search-field"),this.selection=r=this.container.find(t);var i=this;this.selection.on("mousedown",".select2-search-choice",function(t){i.search[0].focus(),i.selectChoice(e(this))}),this.search.attr("id","s2id_autogen"+o()),e("label[for='"+this.opts.element.attr("id")+"']").attr("for",this.search.attr("id")),this.search.on("input paste",this.bind(function(){if(!this.isInterfaceEnabled())return;this.opened()||this.open()})),this.search.attr("tabindex",this.elementTabIndex),this.keydowns=0,this.search.on("keydown",this.bind(function(e){if(!this.isInterfaceEnabled())return;++this.keydowns;var t=r.find(".select2-search-choice-focus"),i=t.prev(".select2-search-choice:not(.select2-locked)"),s=t.next(".select2-search-choice:not(.select2-locked)"),o=x(this.search);if(!(!t.length||e.which!=n.LEFT&&e.which!=n.RIGHT&&e.which!=n.BACKSPACE&&e.which!=n.DELETE&&e.which!=n.ENTER)){var u=t;e.which==n.LEFT&&i.length?u=i:e.which==n.RIGHT?u=s.length?s:null:e.which===n.BACKSPACE?(this.unselect(t.first()),this.search.width(10),u=i.length?i:s):e.which==n.DELETE?(this.unselect(t.first()),this.search.width(10),u=s.length?s:null):e.which==n.ENTER&&(u=null),this.selectChoice(u),T(e),(!u||!u.length)&&this.open();return}if((e.which===n.BACKSPACE&&this.keydowns==1||e.which==n.LEFT)&&o.offset==0&&!o.length){this.selectChoice(r.find(".select2-search-choice:not(.select2-locked)").last()),T(e);return}this.selectChoice(null);if(this.opened())switch(e.which){case n.UP:case n.DOWN:this.moveHighlight(e.which===n.UP?-1:1),T(e);return;case n.ENTER:this.selectHighlighted(),T(e);return;case n.TAB:this.selectHighlighted({noFocus:!0});return;case n.ESC:this.cancel(e),T(e);return}if(e.which===n.TAB||n.isControl(e)||n.isFunctionKey(e)||e.which===n.BACKSPACE||e.which===n.ESC)return;if(e.which===n.ENTER){if(this.opts.openOnEnter===!1)return;if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return}this.open(),(e.which===n.PAGE_UP||e.which===n.PAGE_DOWN)&&T(e),e.which===n.ENTER&&T(e)})),this.search.on("keyup",this.bind(function(e){this.keydowns=0,this.resizeSearch()})),this.search.on("blur",this.bind(function(t){this.container.removeClass("select2-container-active"),this.search.removeClass("select2-focused"),this.selectChoice(null),this.opened()||this.clearSearch(),t.stopImmediatePropagation(),this.opts.element.trigger(e.Event("select2-blur"))})),this.container.on("mousedown",t,this.bind(function(t){if(!this.isInterfaceEnabled())return;if(e(t.target).closest(".select2-search-choice").length>0)return;this.selectChoice(null),this.clearPlaceholder(),this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.open(),this.focusSearch(),t.preventDefault()})),this.container.on("focus",t,this.bind(function(){if(!this.isInterfaceEnabled())return;this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"),this.clearPlaceholder()})),this.initContainerWidth(),this.opts.element.addClass("select2-offscreen"),this.clearSearch()},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.search.prop("disabled",!this.isInterfaceEnabled())},initSelection:function(){var e;this.opts.element.val()===""&&this.opts.element.text()===""&&(this.updateSelection([]),this.close(),this.clearSearch());if(this.select||this.opts.element.val()!==""){var n=this;this.opts.initSelection.call(null,this.opts.element,function(e){e!==t&&e!==null&&(n.updateSelection(e),n.close(),n.clearSearch())})}},clearSearch:function(){var e=this.getPlaceholder(),n=this.getMaxSearchWidth();e!==t&&this.getVal().length===0&&this.search.hasClass("select2-focused")===!1?(this.search.val(e).addClass("select2-default"),this.search.width(n>0?n:this.container.css("width"))):this.search.val("").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")&&this.search.val("").removeClass("select2-default")},opening:function(){this.clearPlaceholder(),this.resizeSearch(),this.parent.opening.apply(this,arguments),this.focusSearch(),this.updateResults(!0),this.search.focus(),this.opts.element.trigger(e.Event("select2-open"))},close:function(){if(!this.opened())return;this.parent.close.apply(this,arguments)},focus:function(){this.close(),this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(t){var n=[],r=[],i=this;e(t).each(function(){h(i.id(this),n)<0&&(n.push(i.id(this)),r.push(this))}),t=r,this.selection.find(".select2-search-choice").remove(),e(t).each(function(){i.addSelectedChoice(this)}),i.postprocessResults()},tokenize:function(){var e=this.search.val();e=this.opts.tokenizer(e,this.data(),this.bind(this.onSelect),this.opts),e!=null&&e!=t&&(this.search.val(e),e.length>0&&this.open())},onSelect:function(e,t){if(!this.triggerSelect(e))return;this.addSelectedChoice(e),this.opts.element.trigger({type:"selected",val:this.id(e),choice:e}),(this.select||!this.opts.closeOnSelect)&&this.postprocessResults(),this.opts.closeOnSelect?(this.close(),this.search.width(10)):this.countSelectableResults()>0?(this.search.width(10),this.resizeSearch(),this.getMaximumSelectionSize()>0&&this.val().length>=this.getMaximumSelectionSize()&&this.updateResults(!0),this.positionDropdown()):(this.close(),this.search.width(10)),this.triggerChange({added:e}),(!t||!t.noFocus)&&this.focusSearch()},cancel:function(){this.close(),this.focusSearch()},addSelectedChoice:function(n){var r=!n.locked,i=e("<li class='select2-search-choice'>    <div></div>    <a href='#' onclick='return false;' class='select2-search-choice-close' tabindex='-1'></a></li>"),s=e("<li class='select2-search-choice select2-locked'><div></div></li>"),o=r?i:s,u=this.id(n),a=this.getVal(),f;f=this.opts.formatSelection(n,o.find("div")),f!=t&&o.find("div").replaceWith("<div title='"+this.opts.escapeMarkup(f)+"'>"+this.opts.escapeMarkup(f)+"</div>"),r&&o.find(".select2-search-choice-close").on("mousedown",T).on("click dblclick",this.bind(function(t){if(!this.isInterfaceEnabled())return;e(t.target).closest(".select2-search-choice").fadeOut("fast",this.bind(function(){this.unselect(e(t.target)),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus"),this.close(),this.focusSearch()})).dequeue(),T(t)})).on("focus",this.bind(function(){if(!this.isInterfaceEnabled())return;this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active")})),o.data("select2-data",n),o.insertBefore(this.searchContainer),a.push(u),this.setVal(a)},unselect:function(e){var t=this.getVal(),n,r;e=e.closest(".select2-search-choice");if(e.length===0)throw"Invalid argument: "+e+". Must be .select2-search-choice";n=e.data("select2-data");if(!n)return;r=h(this.id(n),t),r>=0&&(t.splice(r,1),this.setVal(t),this.select&&this.postprocessResults()),e.remove(),this.opts.element.trigger({type:"removed",val:this.id(n),choice:n}),this.triggerChange({removed:n})},postprocessResults:function(e,t,n){var r=this.getVal(),i=this.results.find(".select2-result"),s=this.results.find(".select2-result-with-children"),o=this;i.each2(function(e,t){var n=o.id(t.data("select2-data"));h(n,r)>=0&&(t.addClass("select2-selected"),t.find(".select2-result-selectable").addClass("select2-selected"))}),s.each2(function(e,t){!t.is(".select2-result-selectable")&&t.find(".select2-result-selectable:not(.select2-selected)").length===0&&t.addClass("select2-selected")}),this.highlight()==-1&&n!==!1&&o.highlight(0),!this.opts.createSearchChoice&&!i.filter(".select2-result:not(.select2-selected)").length>0&&this.results.append("<li class='select2-no-results'>"+o.opts.formatNoMatches(o.search.val())+"</li>")},getMaxSearchWidth:function(){return this.selection.width()-m(this.search)},resizeSearch:function(){var e,t,n,r,i,s=m(this.search);e=C(this.search)+10,t=this.search.offset().left,n=this.selection.width(),r=this.selection.offset().left,i=n-(t-r)-s,i<e&&(i=n-s),i<40&&(i=n-s),i<=0&&(i=e),this.search.width(i)},getVal:function(){var e;return this.select?(e=this.select.val(),e===null?[]:e):(e=this.opts.element.val(),v(e,this.opts.separator))},setVal:function(t){var n;this.select?this.select.val(t):(n=[],e(t).each(function(){h(this,n)<0&&n.push(this)}),this.opts.element.val(n.length===0?"":n.join(this.opts.separator)))},buildChangeDetails:function(e,t){var t=t.slice(0),e=e.slice(0);for(var n=0;n<t.length;n++)for(var r=0;r<e.length;r++)d(this.opts.id(t[n]),this.opts.id(e[r]))&&(t.splice(n,1),n--,e.splice(r,1),r--);return{added:t,removed:e}},val:function(n,r){var i,s=this,o;if(arguments.length===0)return this.getVal();i=this.data(),i.length||(i=[]);if(!n&&n!==0){this.opts.element.val(""),this.updateSelection([]),this.clearSearch(),r&&this.triggerChange({added:this.data(),removed:i});return}this.setVal(n);if(this.select)this.opts.initSelection(this.select,this.bind(this.updateSelection)),r&&this.triggerChange(this.buildChangeDetails(i,this.data()));else{if(this.opts.initSelection===t)throw new Error("val() cannot be called if initSelection() is not defined");this.opts.initSelection(this.opts.element,function(t){var n=e(t).map(s.id);s.setVal(n),s.updateSelection(t),s.clearSearch(),r&&s.triggerChange(this.buildChangeDetails(i,this.data()))})}this.clearSearch()},onSortStart:function(){if(this.select)throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0),this.searchContainer.hide()},onSortEnd:function(){var t=[],n=this;this.searchContainer.show(),this.searchContainer.appendTo(this.searchContainer.parent()),this.resizeSearch(),this.selection.find(".select2-search-choice").each(function(){t.push(n.opts.id(e(this).data("select2-data")))}),this.setVal(t),this.triggerChange()},data:function(t,n){var r=this,i,s;if(arguments.length===0)return this.selection.find(".select2-search-choice").map(function(){return e(this).data("select2-data")}).get();s=this.data(),t||(t=[]),i=e.map(t,function(e){return r.opts.id(e)}),this.setVal(i),this.updateSelection(t),this.clearSearch(),n&&this.triggerChange(this.buildChangeDetails(s,this.data()))}}),e.fn.select2=function(){var n=Array.prototype.slice.call(arguments,0),r,o,u,a,f=["val","destroy","opened","open","close","focus","isFocused","container","onSortStart","onSortEnd","enable","readonly","positionDropdown","data"],l=["val","opened","isFocused","container","data"];return this.each(function(){if(n.length===0||typeof n[0]=="object")r=n.length===0?{}:e.extend({},n[0]),r.element=e(this),r.element.get(0).tagName.toLowerCase()==="select"?a=r.element.prop("multiple"):(a=r.multiple||!1,"tags"in r&&(r.multiple=a=!0)),o=a?new s:new i,o.init(r);else{if(typeof n[0]!="string")throw"Invalid arguments to select2 plugin: "+n;if(h(n[0],f)<0)throw"Unknown method: "+n[0];u=t,o=e(this).data("select2");if(o===t)return;n[0]==="container"?u=o.container:u=o[n[0]].apply(o,n.slice(1));if(h(n[0],l)>=0)return!1}}),u===t?this:u},e.fn.select2.defaults={width:"copy",loadMorePadding:0,closeOnSelect:!0,openOnEnter:!0,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(e,t,n,r){var i=[];return L(e.text,n.term,i,r),i.join("")},formatSelection:function(e,n){return e?e.text:t},sortResults:function(e,t,n){return e},formatResultCssClass:function(e){return t},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(e,t){var n=t-e.length;return"Please enter "+n+" more character"+(n==1?"":"s")},formatInputTooLong:function(e,t){var n=e.length-t;return"Please delete "+n+" character"+(n==1?"":"s")},formatSelectionTooBig:function(e){return"You can only select "+e+" item"+(e==1?"":"s")},formatLoadMore:function(e){return"Loading more results..."},formatSearching:function(){return"Searching..."},minimumResultsForSearch:0,minimumInputLength:0,maximumInputLength:null,maximumSelectionSize:0,id:function(e){return e.id},matcher:function(e,t){return(""+t).toUpperCase().indexOf((""+e).toUpperCase())>=0},separator:",",tokenSeparators:[],tokenizer:H,escapeMarkup:function(e){var t={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return String(e).replace(/[&<>"'\/\\]/g,function(e){return t[e]})},blurOnChange:!1,selectOnBlur:!1,adaptContainerCssClass:function(e){return e},adaptDropdownCssClass:function(e){return null}},e.fn.select2.ajaxDefaults={transport:e.ajax,params:{type:"GET",cache:!1,dataType:"json"}},window.Select2={query:{ajax:A,local:O,tags:M},util:{debounce:b,markMatch:L},"class":{"abstract":r,single:i,multi:s}}}(jQuery),define("jam/plone-select2/select2",function(){}),function(e,t){typeof exports=="object"?module.exports=t(require("jquery")):typeof define=="function"&&define.amd?define("jam/jquery.event.drag/jquery.event.drag",["jquery"],t):e.returnExports=t(e.jQuery)}(this,function(e){(function(e){e.fn.drag=function(t,n,r){var i=typeof t=="string"?t:"",s=e.isFunction(t)?t:e.isFunction(n)?n:null;return i.indexOf("drag")!==0&&(i="drag"+i),r=(t==s?n:r)||{},s?this.bind(i,r,s):this.trigger(i)};var t=e.event,n=t.special,r=n.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(t){var n=e.data(this,r.datakey),i=t.data||{};n.related+=1,e.each(r.defaults,function(e,t){i[e]!==undefined&&(n[e]=i[e])})},remove:function(){e.data(this,r.datakey).related-=1},setup:function(){if(e.data(this,r.datakey))return;var n=e.extend({related:0},r.defaults);e.data(this,r.datakey,n),t.add(this,"touchstart mousedown",r.init,n),this.attachEvent&&this.attachEvent("ondragstart",r.dontstart)},teardown:function(){var n=e.data(this,r.datakey)||{};if(n.related)return;e.removeData(this,r.datakey),t.remove(this,"touchstart mousedown",r.init),r.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",r.dontstart)},init:function(i){if(r.touched)return;var s=i.data,o;if(i.which!=0&&s.which>0&&i.which!=s.which)return;if(e(i.target).is(s.not))return;if(s.handle&&!e(i.target).closest(s.handle,i.currentTarget).length)return;r.touched=i.type=="touchstart"?this:null,s.propagates=1,s.mousedown=this,s.interactions=[r.interaction(this,s)],s.target=i.target,s.pageX=i.pageX,s.pageY=i.pageY,s.dragging=null,o=r.hijack(i,"draginit",s);if(!s.propagates)return;o=r.flatten(o),o&&o.length&&(s.interactions=[],e.each(o,function(){s.interactions.push(r.interaction(this,s))})),s.propagates=s.interactions.length,s.drop!==!1&&n.drop&&n.drop.handler(i,s),r.textselect(!1),r.touched?t.add(r.touched,"touchmove touchend",r.handler,s):t.add(document,"mousemove mouseup",r.handler,s);if(!r.touched||s.live)return!1},interaction:function(t,n){var i=e(t)[n.relative?"position":"offset"]()||{top:0,left:0};return{drag:t,callback:new r.callback,droppable:[],offset:i}},handler:function(i){var s=i.data;switch(i.type){case!s.dragging&&"touchmove":i.preventDefault();case!s.dragging&&"mousemove":if(Math.pow(i.pageX-s.pageX,2)+Math.pow(i.pageY-s.pageY,2)<Math.pow(s.distance,2))break;i.target=s.target,r.hijack(i,"dragstart",s),s.propagates&&(s.dragging=!0);case"touchmove":i.preventDefault();case"mousemove":if(s.dragging){r.hijack(i,"drag",s);if(s.propagates){s.drop!==!1&&n.drop&&n.drop.handler(i,s);break}i.type="mouseup"};case"touchend":case"mouseup":default:r.touched?t.remove(r.touched,"touchmove touchend",r.handler):t.remove(document,"mousemove mouseup",r.handler),s.dragging&&(s.drop!==!1&&n.drop&&n.drop.handler(i,s),r.hijack(i,"dragend",s)),r.textselect(!0),s.click===!1&&s.dragging&&e.data(s.mousedown,"suppress.click",(new Date).getTime()+5),s.dragging=r.touched=!1}},hijack:function(n,i,s,o,u){if(!s)return;var a={event:n.originalEvent,type:n.type},f=i.indexOf("drop")?"drag":"drop",l,c=o||0,h,p,d,v=isNaN(o)?s.interactions.length:o;n.type=i,n.originalEvent=null,s.results=[];do if(h=s.interactions[c]){if(i!=="dragend"&&h.cancelled)continue;d=r.properties(n,s,h),h.results=[],e(u||h[f]||s.droppable).each(function(o,u){d.target=u,n.isPropagationStopped=function(){return!1},l=u?t.dispatch.call(u,n,d):null,l===!1?(f=="drag"&&(h.cancelled=!0,s.propagates-=1),i=="drop"&&(h[f][o]=null)):i=="dropinit"&&h.droppable.push(r.element(l)||u),i=="dragstart"&&(h.proxy=e(r.element(l)||h.drag)[0]),h.results.push(l),delete n.result;if(i!=="dropinit")return l}),s.results[c]=r.flatten(h.results),i=="dropinit"&&(h.droppable=r.flatten(h.droppable)),i=="dragstart"&&!h.cancelled&&d.update()}while(++c<v);return n.type=a.type,n.originalEvent=a.event,r.flatten(s.results)},properties:function(e,t,n){var i=n.callback;return i.drag=n.drag,i.proxy=n.proxy||n.drag,i.startX=t.pageX,i.startY=t.pageY,i.deltaX=e.pageX-t.pageX,i.deltaY=e.pageY-t.pageY,i.originalX=n.offset.left,i.originalY=n.offset.top,i.offsetX=i.originalX+i.deltaX,i.offsetY=i.originalY+i.deltaY,i.drop=r.flatten((n.drop||[]).slice()),i.available=r.flatten((n.droppable||[]).slice()),i},element:function(e){if(e&&(e.jquery||e.nodeType==1))return e},flatten:function(t){return e.map(t,function(t){return t&&t.jquery?e.makeArray(t):t&&t.length?r.flatten(t):t})},textselect:function(t){e(document)[t?"unbind":"bind"]("selectstart",r.dontstart).css("MozUserSelect",t?"":"none"),document.unselectable=t?"off":"on"},dontstart:function(){return!1},callback:function(){}};r.callback.prototype={update:function(){n.drop&&this.available.length&&e.each(this.available,function(e){n.drop.locate(this,e)})}};var i=t.dispatch;t.dispatch=function(t){if(e.data(this,"suppress."+t.type)-(new Date).getTime()>0){e.removeData(this,"suppress."+t.type);return}return i.apply(this,arguments)};var s=t.fixHooks.touchstart=t.fixHooks.touchmove=t.fixHooks.touchend=t.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(t,n){if(n){var r=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0]||null;r&&e.each(s.props,function(e,n){t[n]=r[n]})}return t}};n.draginit=n.dragstart=n.dragend=r})(e)}),function(e){e.fn.drop=function(t,n,r){var i=typeof t=="string"?t:"",s=e.isFunction(t)?t:e.isFunction(n)?n:null;return i.indexOf("drop")!==0&&(i="drop"+i),r=(t==s?n:r)||{},s?this.bind(i,r,s):this.trigger(i)},e.drop=function(t){t=t||{},r.multi=t.multi===!0?Infinity:t.multi===!1?1:isNaN(t.multi)?r.multi:t.multi,r.delay=t.delay||r.delay,r.tolerance=e.isFunction(t.tolerance)?t.tolerance:t.tolerance===null?null:r.tolerance,r.mode=t.mode||r.mode||"intersect"};var t=e.event,n=t.special,r=e.event.special.drop={multi:1,delay:20,mode:"overlap",targets:[],datakey:"dropdata",noBubble:!0,add:function(t){var n=e.data(this,r.datakey);n.related+=1},remove:function(){e.data(this,r.datakey).related-=1},setup:function(){if(e.data(this,r.datakey))return;var t={related:0,active:[],anyactive:0,winner:0,location:{}};e.data(this,r.datakey,t),r.targets.push(this)},teardown:function(){var t=e.data(this,r.datakey)||{};if(t.related)return;e.removeData(this,r.datakey);var n=this;r.targets=e.grep(r.targets,function(e){return e!==n})},handler:function(t,i){var s,o;if(!i)return;switch(t.type){case"mousedown":case"touchstart":o=e(r.targets),typeof i.drop=="string"&&(o=o.filter(i.drop)),o.each(function(){var t=e.data(this,r.datakey);t.active=[],t.anyactive=0,t.winner=0}),i.droppable=o,n.drag.hijack(t,"dropinit",i);break;case"mousemove":case"touchmove":r.event=t,r.timer||r.tolerate(i);break;case"mouseup":case"touchend":r.timer=clearTimeout(r.timer),i.propagates&&(n.drag.hijack(t,"drop",i),n.drag.hijack(t,"dropend",i))}},locate:function(t,n){var i=e.data(t,r.datakey),s=e(t),o=s.offset()||{},u=s.outerHeight(),a=s.outerWidth(),f={elem:t,width:a,height:u,top:o.top,left:o.left,right:o.left+a,bottom:o.top+u};return i&&(i.location=f,i.index=n,i.elem=t),f},contains:function(e,t){return(t[0]||t.left)>=e.left&&(t[0]||t.right)<=e.right&&(t[1]||t.top)>=e.top&&(t[1]||t.bottom)<=e.bottom},modes:{intersect:function(e,t,n){return this.contains(n,[e.pageX,e.pageY])?1e9:this.modes.overlap.apply(this,arguments)},overlap:function(e,t,n){return Math.max(0,Math.min(n.bottom,t.bottom)-Math.max(n.top,t.top))*Math.max(0,Math.min(n.right,t.right)-Math.max(n.left,t.left))},fit:function(e,t,n){return this.contains(n,t)?1:0},middle:function(e,t,n){return this.contains(n,[t.left+t.width*.5,t.top+t.height*.5])?1:0}},sort:function(e,t){return t.winner-e.winner||e.index-t.index},tolerate:function(t){var i,s,o,u,a,f,l,c=0,h,p=t.interactions.length,d=[r.event.pageX,r.event.pageY],v=r.tolerance||r.modes[r.mode];do if(h=t.interactions[c]){if(!h)return;h.drop=[],a=[],f=h.droppable.length,v&&(o=r.locate(h.proxy)),i=0;do if(l=h.droppable[i]){u=e.data(l,r.datakey),s=u.location;if(!s)continue;u.winner=v?v.call(r,r.event,o,s):r.contains(s,d)?1:0,a.push(u)}while(++i<f);a.sort(r.sort),i=0;do if(u=a[i])u.winner&&h.drop.length<r.multi?(!u.active[c]&&!u.anyactive&&(n.drag.hijack(r.event,"dropstart",t,c,u.elem)[0]!==!1?(u.active[c]=1,u.anyactive+=1):u.winner=0),u.winner&&h.drop.push(u.elem)):u.active[c]&&u.anyactive==1&&(n.drag.hijack(r.event,"dropend",t,c,u.elem),u.active[c]=0,u.anyactive-=1);while(++i<f)}while(++c<p);r.last&&d[0]==r.last.pageX&&d[1]==r.last.pageY?delete r.timer:r.timer=setTimeout(function(){r.tolerate(t)},r.delay),r.last=r.event}};n.dropinit=n.dropstart=n.dropend=r}(jQuery),define("jam/jquery.event.drop/jquery.event.drop",function(){}),define("js/patterns/select2",["jquery","js/patterns/base","jam/plone-select2/select2","jam/jquery.event.drag/jquery.event.drag","jam/jquery.event.drop/jquery.event.drop"],function(e,t){var n=t.extend({name:"select2",defaults:{separator:","},initializeValueMap:function(){var t=this;t.options.initvaluemap&&(t.options.initSelection=function(n,r){var i=[],s=n.val(),o={};typeof t.options.initvaluemap=="string"&&t.options.initvaluemap!==""&&(t.options.initvaluemap[0]==="{"?o=JSON.parse(t.options.initvaluemap):(o={},e(t.options.initvaluemap.split(t.options.separator)).each(function(){var e=this.split(":"),t=e[0],n=e[1];o[t]=n}))),e(s.split(t.options.separator)).each(function(){var e=this;o[this]&&(e=o[this]),i.push({id:this,text:e})}),r(i)})},initializeTags:function(){var e=this;e.options.tags&&typeof e.options.tags=="string"&&(e.options.tags.substr(0,1)==="["?e.options.tags=JSON.parse(e.options.tags):e.options.tags=e.options.tags.split(e.options.separator))},initializeOrdering:function(){var t=this;if(t.options.orderable){var n=function(e,t){return e?e.text:undefined};t.options.formatSelection&&(n=t.options.formatSelection),t.options.formatSelection=function(r,i){return i.parents("li").drag("start",function(n,r){e(this).addClass("select2-choice-dragging"),t.$el.select2("onSortStart"),e.drop({tolerance:function(t,n,r){var i=t.pageY>r.top+r.height/2;return e.data(r.elem,"drop+reorder",i?"insertAfter":"insertBefore"),this.contains(r,[t.pageX,t.pageY])}})}).drag(function(t,n){var r=n.drop[0],i=e.data(r||{},"drop+reorder");r&&(r!=n.current||i!=n.method)&&(e(this)[i](r),n.current=r,n.method=i,n.update())}).drag("end",function(n,r){e(this).removeClass("select2-choice-dragging"),t.$el.select2("onSortEnd")}).drop("init",function(e,t){return this!=t.drag}),n(r,i)}}},initializeSelect2:function(){var e=this;e.$el.select2(e.options),e.$select2=e.$el.parent().find(".select2-container"),e.$el.parent().off("close.modal.patterns"),e.options.orderable&&e.$select2.addClass("select2-orderable")},init:function(){var t=this;t.initializeValueMap(),t.initializeTags();if(t.options.ajax||t.options.ajaxvocabulary){t.options.ajaxvocabulary&&(t.options.multiple=!0,t.options.ajax=t.options.ajax||{},t.options.ajax.url=t.options.ajaxvocabulary,t.options.initSelection=function(n,r){var i=[],s=n.val();e(s.split(t.options.separator)).each(function(){i.push({id:this,text:this})}),r(i)});var n="";t.options.ajax=e.extend({quietMillis:300,data:function(e,t){return n=e,{query:e,page_limit:10,page:t}},results:function(r,i){var s=r.results;if(t.options.ajaxvocabulary){var o=[];e.each(r.results,function(e,t){o.push(t.id)}),s=[],n!==""&&e.inArray(n,o)===-1&&s.push({id:n,text:n}),e.each(r.results,function(e,n){t.options.ajaxvocabulary?s.push({id:n.text,text:n.text}):s.push(n)})}return{results:s}}},t.options.ajax)}t.initializeOrdering(),t.initializeSelect2()}});return n}),window.Picker=function(e,t,n){function r(i,s,o,u){function d(){return r._.node("div",r._.node("div",r._.node("div",r._.node("div",p.component.nodes(a.open),l.box),l.wrap),l.frame),l.holder)}function v(e){e.stopPropagation(),e.type=="focus"&&p.$root.addClass(l.focused),p.open()}if(!i)return r;var a={id:Math.abs(~~(Math.random()*1e9))},f=o?e.extend(!0,{},o.defaults,u):u||{},l=e.extend({},r.klasses(),f.klass),c=e(i),h=function(){return this.start()},p=h.prototype={constructor:h,$node:c,start:function(){return a&&a.start?p:(a.methods={},a.start=!0,a.open=!1,a.type=i.type,i.autofocus=i==document.activeElement,i.type="text",i.readOnly=!0,p.component=new o(p,f),p.$root=e(r._.node("div",d(),l.picker)).on({focusin:function(e){p.$root.removeClass(l.focused),e.stopPropagation()},mousedown:function(e){e.target!=p.$root.children()[0]&&e.stopPropagation()},click:function(t){var n=t.target,s=n.attributes.length?e(n):e(n).closest("[data-pick]"),o=s.data();n!=p.$root.children()[0]&&(t.stopPropagation(),p.$root.find(document.activeElement).length||i.focus(),o.nav&&!s.hasClass(l.navDisabled)?p.set("highlight",p.component.item.highlight,{nav:o.nav}):r._.isInteger(o.pick)&&!s.hasClass(l.disabled)?p.set("select",o.pick).close(!0):o.clear&&p.clear().close(!0))}}),p._hidden=f.formatSubmit?e("<input type=hidden name="+i.name+(f.hiddenSuffix||"_submit")+(c.data("value")?' value="'+r._.trigger(p.component.formats.toString,p.component,[f.formatSubmit,p.component.item.select])+'"':"")+">")[0]:n,c.addClass(l.input).on("focus.P"+a.id+" click.P"+a.id,v).on("change.P"+a.id,function(){p._hidden&&(p._hidden.value=i.value?r._.trigger(p.component.formats.toString,p.component,[f.formatSubmit,p.component.item.select]):"")}).on("keydown.P"+a.id,function(e){var t=e.keyCode,n=/^(8|46)$/.test(t);if(t==27)return p.close(),!1;if(t==32||n||!a.open&&p.component.key[t])e.preventDefault(),e.stopPropagation(),n?p.clear().close():p.open()}).val(c.data("value")?r._.trigger(p.component.formats.toString,p.component,[f.format,p.component.item.select]):i.value).after(p.$root,p._hidden).data(s,p),p.on({start:p.component.onStart,render:p.component.onRender,stop:p.component.onStop,open:p.component.onOpen,close:p.component.onClose,set:p.component.onSet}).on({start:f.onStart,render:f.onRender,stop:f.onStop,open:f.onOpen,close:f.onClose,set:f.onSet}),i.autofocus&&p.open(),p.trigger("start").trigger("render"))},render:function(){return p.$root.html(d()),p.trigger("render")},stop:function(){return a.start?(p.close(),p._hidden&&p._hidden.parentNode.removeChild(p._hidden),p.$root.remove(),c.removeClass(l.input).off(".P"+a.id).removeData(s),i.type=a.type,i.readOnly=!1,p.trigger("stop"),a.methods={},a.start=!1,p):p},open:function(e){return a.open?p:(c.addClass(l.active),p.$root.addClass(l.opened),e!==!1&&(a.open=!0,c.focus(),t.on("click.P"+a.id+" focusin.P"+a.id,function(e){e.target!=i&&e.target!=document&&p.close()}).on("keydown.P"+a.id,function(e){var t=e.keyCode,n=p.component.key[t],s=e.target;t==27?p.close(!0):s!=i||!n&&t!=13?p.$root.find(s).length&&t==13&&(e.preventDefault(),s.click()):(e.preventDefault(),n?r._.trigger(p.component.key.go,p,[n]):p.$root.find("."+l.highlighted).hasClass(l.disabled)||p.set("select",p.component.item.highlight).close())})),p.trigger("open"))},close:function(e){return e&&(c.off("focus.P"+a.id).focus(),setTimeout(function(){c.on("focus.P"+a.id,v)},0)),c.removeClass(l.active),p.$root.removeClass(l.opened+" "+l.focused),a.open&&(a.open=!1,t.off(".P"+a.id)),p.trigger("close")},clear:function(){return p.set("clear")},set:function(e,t,n){var i,s,o=r._.isObject(e),u=o?e:{};if(e){o||(u[e]=t);for(i in u)s=u[i],p.component.item[i]&&p.component.set(i,s,n||{}),(i=="select"||i=="clear")&&c.val(i=="clear"?"":r._.trigger(p.component.formats.toString,p.component,[f.format,p.component.get(i)])).trigger("change");p.render()}return p.trigger("set",u)},get:function(e,t){e=e||"value";if(a[e]!=null)return a[e];if(e=="value")return i.value;if(p.component.item[e])return typeof t=="string"?r._.trigger(p.component.formats.toString,p.component,[t,p.component.get(e)]):p.component.get(e)},on:function(e,t){var n,i,s=r._.isObject(e),o=s?e:{};if(e){s||(o[e]=t);for(n in o)i=o[n],a.methods[n]=a.methods[n]||[],a.methods[n].push(i)}return p},trigger:function(e,t){var n=a.methods[e];return n&&n.map(function(e){r._.trigger(e,p,[t])}),p}};return new h}return r.klasses=function(e){return e=e||"picker",{picker:e,opened:e+"--opened",focused:e+"--focused",input:e+"__input",active:e+"__input--active",holder:e+"__holder",frame:e+"__frame",wrap:e+"__wrap",box:e+"__box"}},r._={group:function(e){var t,n="",i=r._.trigger(e.min,e);for(;i<=r._.trigger(e.max,e,[i]);i+=e.i)t=r._.trigger(e.item,e,[i]),n+=r._.node(e.node,t[0],t[1],t[2]);return n},node:function(e,t,n,r){return t?(t=Array.isArray(t)?t.join(""):t,n=n?' class="'+n+'"':"",r=r?" "+r:"","<"+e+n+r+">"+t+"</"+e+">"):""},lead:function(e){return(e<10?"0":"")+e},trigger:function(e,t,n){return typeof e=="function"?e.apply(t,n||[]):e},digits:function(e){return/\d/.test(e[1])?2:1},isObject:function(e){return{}.toString.call(e).indexOf("Object")>-1},isDate:function(e){return{}.toString.call(e).indexOf("Date")>-1},isInteger:function(e){return{}.toString.call(e).indexOf("Number")>-1&&e%1===0}},r.extend=function(t,n){e.fn[t]=function(i,s){var o=this.data(t);return i=="picker"?o:o&&typeof i=="string"?(r._.trigger(o[i],o,[s]),this):this.each(function(){var s=e(this);s.data(t)||new r(this,t,n,i)})},e.fn[t].defaults=n.defaults},r}(jQuery,jQuery(document)),define("jam/pickadate/_raw/lib/picker",function(){}),function(){function n(e,t){var n=this,r=e.$node.data("value");n.settings=t,n.queue={min:"measure create",max:"measure create",now:"now create",select:"parse create validate",highlight:"navigate create validate",view:"create validate viewset",disable:"flipItem",enable:"flipItem"},n.item={},n.item.disable=(t.disable||[]).slice(0),n.item.enable=-function(e){return e[0]===!0?e.shift():-1}(n.item.disable),n.set("min",t.min).set("max",t.max).set("now").set("select",r||e.$node[0].value||n.item.now,{format:r?t.formatSubmit:t.format,data:!!r}),n.key={40:7,38:-7,39:1,37:-1,go:function(e){n.set("highlight",[n.item.highlight.year,n.item.highlight.month,n.item.highlight.date+e],{interval:e}),this.render()}},e.on("render",function(){e.$root.find("."+t.klass.selectMonth).on("change",function(){e.set("highlight",[e.get("view").year,this.value,e.get("highlight").date]),e.$root.find("."+t.klass.selectMonth).focus()}),e.$root.find("."+t.klass.selectYear).on("change",function(){e.set("highlight",[this.value,e.get("view").month,e.get("highlight").date]),e.$root.find("."+t.klass.selectYear).focus()})}).on("open",function(){e.$root.find("button, select").attr("disabled",!1)}).on("close",function(){e.$root.find("button, select").attr("disabled",!0)})}var e=7,t=6;n.prototype.set=function(e,t,n){var r=this;return r.item[e=="enable"?"disable":e=="flip"?"enable":e]=r.queue[e].split(" ").map(function(i){return t=r[i](e,t,n)}).pop(),e=="select"?r.set("highlight",r.item.select,n):e=="highlight"?r.set("view",r.item.highlight,n):(e=="flip"||e=="min"||e=="max"||e=="disable"||e=="enable")&&r.item.select&&r.item.highlight&&r.set("select",r.item.select,n).set("highlight",r.item.highlight,n),r},n.prototype.get=function(e){return this.item[e]},n.prototype.create=function(e,t,n){var r,i=this;return t=t===undefined?e:t,t==-Infinity||t==Infinity?r=t:Picker._.isObject(t)&&Picker._.isInteger(t.pick)?t=t.obj:Array.isArray(t)?t=new Date(t[0],t[1],t[2]):Picker._.isInteger(t)||Picker._.isDate(t)?t=i.normalize(new Date(t),n):t=i.now(e,t,n),{year:r||t.getFullYear(),month:r||t.getMonth(),date:r||t.getDate(),day:r||t.getDay(),obj:r||t,pick:r||t.getTime()}},n.prototype.now=function(e,t,n){return t=new Date,n&&n.rel&&t.setDate(t.getDate()+n.rel),this.normalize(t,n)},n.prototype.navigate=function(e,t,n){if(Picker._.isObject(t)){var r=new Date(t.year,t.month+(n&&n.nav?n.nav:0),1),i=r.getFullYear(),s=r.getMonth(),o=t.date;while((new Date(i,s,o)).getMonth()!==s)o-=1;t=[i,s,o]}return t},n.prototype.normalize=function(e){return e.setHours(0,0,0,0),e},n.prototype.measure=function(e,t){var n=this;return t?Picker._.isInteger(t)&&(t=n.now(e,t,{rel:t})):t=e=="min"?-Infinity:Infinity,t},n.prototype.viewset=function(e,t){return this.create([t.year,t.month,1])},n.prototype.validate=function(e,t,n){var r=this,i=t,s=n&&n.interval?n.interval:1,o=r.item.enable===-1,u,a,f=r.item.min,l=r.item.max,c,h,p=o&&r.item.disable.filter(function(e){if(Array.isArray(e)){var n=r.create(e).pick;n<t.pick?u=!0:n>t.pick&&(a=!0)}return Picker._.isInteger(e)}).length;if(!o&&r.disabled(t)||o&&r.disabled(t)&&(p||u||a)||t.pick<=f.pick||t.pick>=l.pick){o&&!p&&(!a&&s>0||!u&&s<0)&&(s*=-1);while(r.disabled(t)){Math.abs(s)>1&&(t.month<i.month||t.month>i.month)&&(t=i,s=Math.abs(s)/s),t.pick<=f.pick?(c=!0,s=1):t.pick>=l.pick&&(h=!0,s=-1);if(c&&h)break;t=r.create([t.year,t.month,t.date+s])}}return t},n.prototype.disabled=function(e){var t=this,n=t.item.disable.filter(function(n){if(Picker._.isInteger(n))return e.day===(t.settings.firstDay?n:n-1)%7;if(Array.isArray(n))return e.pick===t.create(n).pick}).length;return e.pick<t.item.min.pick||e.pick>t.item.max.pick||t.item.enable===-1?!n:n},n.prototype.parse=function(e,t,n){var r=this,i={};if(!t||Picker._.isInteger(t)||Array.isArray(t)||Picker._.isDate(t)||Picker._.isObject(t)&&Picker._.isInteger(t.pick))return t;if(!n||!n.format)throw"Need a formatting option to parse this..";return r.formats.toArray(n.format).map(function(e){var n=r.formats[e],s=n?Picker._.trigger(n,r,[t,i]):e.replace(/^!/,"").length;n&&(i[e]=t.substr(0,s)),t=t.substr(s)}),[i.yyyy||i.yy,+(i.mm||i.m)-(n.data?1:0),i.dd||i.d]},n.prototype.formats=function(){var e=function(e,t,n){var r=e.match(/\w+/)[0];return!n.mm&&!n.m&&(n.m=t.indexOf(r)),r.length};return{d:function(e,t){return e?Picker._.digits(e):t.date},dd:function(e,t){return e?2:Picker._.lead(t.date)},ddd:function(e,t){return e?getFirstWordLength(e):this.settings.weekdaysShort[t.day]},dddd:function(e,t){return e?getFirstWordLength(e):this.settings.weekdaysFull[t.day]},m:function(e,t){return e?Picker._.digits(e):t.month+1},mm:function(e,t){return e?2:Picker._.lead(t.month+1)},mmm:function(t,n){var r=this.settings.monthsShort;return t?e(t,r,n):r[n.month]},mmmm:function(t,n){var r=this.settings.monthsFull;return t?e(t,r,n):r[n.month]},yy:function(e,t){return e?2:(""+t.year).slice(2)},yyyy:function(e,t){return e?4:t.year},toArray:function(e){return e.split(/(d{1,4}|m{1,4}|y{4}|yy|!.)/g)},toString:function(e,t){var n=this;return n.formats.toArray(e).map(function(e){return Picker._.trigger(n.formats[e],n,[0,t])||e.replace(/^!/,"")}).join("")}}}(),n.prototype.flipItem=function(e,t){var n=this,r=n.item.disable,i=n.item.enable===-1;if(t=="flip")n.item.enable=i?1:-1;else if(!i&&e=="enable"||i&&e=="disable")r=n.removeDisabled(r,t);else if(!i&&e=="disable"||i&&e=="enable")r=n.addDisabled(r,t);return r},n.prototype.addDisabled=function(e,t){var n=this;return t.map(function(t){n.filterDisabled(e,t).length||e.push(t)}),e},n.prototype.removeDisabled=function(e,t){var n=this;return t.map(function(t){e=n.filterDisabled(e,t,1)}),e},n.prototype.filterDisabled=function(e,t,n){var r=Array.isArray(t);return e.filter(function(e){var i=!r&&t===e||r&&Array.isArray(e)&&t.toString()===e.toString();return n?!i:i})},n.prototype.nodes=function(n){var r=this,i=r.settings,s=r.item.now,o=r.item.select,u=r.item.highlight,a=r.item.view,f=r.item.disable,l=r.item.min,c=r.item.max,h=function(t){return i.firstDay&&t.push(t.shift()),Picker._.node("thead",Picker._.group({min:0,max:e-1,i:1,node:"th",item:function(e){return[t[e],i.klass.weekdays]}}))}((i.showWeekdaysFull?i.weekdaysFull:i.weekdaysShort).slice(0)),p=function(e){return Picker._.node("div"," ",i.klass["nav"+(e?"Next":"Prev")]+(e&&a.year>=c.year&&a.month>=c.month||!e&&a.year<=l.year&&a.month<=l.month?" "+i.klass.navDisabled:""),"data-nav="+(e||-1))},d=function(e){return i.selectMonths?Picker._.node("select",Picker._.group({min:0,max:11,i:1,node:"option",item:function(t){return[e[t],0,"value="+t+(a.month==t?" selected":"")+(a.year==l.year&&t<l.month||a.year==c.year&&t>c.month?" disabled":"")]}}),i.klass.selectMonth,n?"":"disabled"):Picker._.node("div",e[a.month],i.klass.month)},v=function(){var e=a.year,t=i.selectYears===!0?5:~~(i.selectYears/2);if(t){var r=l.year,s=c.year,o=e-t,u=e+t;r>o&&(u+=r-o,o=r);if(s<u){var f=o-r,h=u-s;o-=f>h?h:f,u=s}return Picker._.node("select",Picker._.group({min:o,max:u,i:1,node:"option",item:function(t){return[t,0,"value="+t+(e==t?" selected":"")]}}),i.klass.selectYear,n?"":"disabled")}return Picker._.node("div",e,i.klass.year)};return Picker._.node("div",p()+p(1)+d(i.showMonthsShort?i.monthsShort:i.monthsFull)+v(),i.klass.header)+Picker._.node("table",h+Picker._.node("tbody",Picker._.group({min:0,max:t-1,i:1,node:"tr",item:function(t){var n=i.firstDay&&r.create([a.year,a.month,1]).day===0?-7:0;return[Picker._.group({min:e*t-a.day+n+1,max:function(){return this.min+e-1},i:1,node:"td",item:function(e){return e=r.create([a.year,a.month,e+(i.firstDay?1:0)]),[Picker._.node("div",e.date,function(t){return t.push(a.month==e.month?i.klass.infocus:i.klass.outfocus),s.pick==e.pick&&t.push(i.klass.now),o&&o.pick==e.pick&&t.push(i.klass.selected),u&&u.pick==e.pick&&t.push(i.klass.highlighted),(f&&r.disabled(e)||e.pick<l.pick||e.pick>c.pick)&&t.push(i.klass.disabled),t.join(" ")}([i.klass.day]),"data-pick="+e.pick)]}})]}})),i.klass.table)+Picker._.node("div",Picker._.node("button",i.today,i.klass.buttonToday,"data-pick="+s.pick+(n?"":" disabled"))+Picker._.node("button",i.clear,i.klass.buttonClear,"data-clear=1"+(n?"":" disabled")),i.klass.footer)},n.defaults=function(e){return{monthsFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdaysFull:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],today:"Today",clear:"Clear",format:"d mmmm, yyyy",klass:{table:e+"table",header:e+"header",navPrev:e+"nav--prev",navNext:e+"nav--next",navDisabled:e+"nav--disabled",month:e+"month",year:e+"year",selectMonth:e+"select--month",selectYear:e+"select--year",weekdays:e+"weekday",day:e+"day",disabled:e+"day--disabled",selected:e+"day--selected",highlighted:e+"day--highlighted",now:e+"day--today",infocus:e+"day--infocus",outfocus:e+"day--outfocus",footer:e+"footer",buttonClear:e+"button--clear",buttonToday:e+"button--today"}}}(Picker.klasses().picker+"__"),Picker.extend("pickadate",n)}(),define("jam/pickadate/_raw/lib/picker.date",function(){}),function(){function i(e,t){var n=this,r=e.$node.data("value");n.settings=t,n.queue={interval:"i",min:"measure create",max:"measure create",now:"now create",select:"parse create validate",highlight:"create validate",view:"create validate",disable:"flipItem",enable:"flipItem"},n.item={},n.item.interval=t.interval||30,n.item.disable=(t.disable||[]).slice(0),n.item.enable=-function(e){return e[0]===!0?e.shift():-1}(n.item.disable),n.set("min",t.min).set("max",t.max).set("now").set("select",r||e.$node[0].value||n.item.min,{format:r?t.formatSubmit:t.format}),n.key={40:1,38:-1,39:1,37:-1,go:function(e){n.set("highlight",n.item.highlight.pick+e*n.item.interval,{interval:e*n.item.interval}),this.render()}},e.on("render",function(){var r=e.$root.children(),i=r.find("."+t.klass.viewset);i.length?r[0].scrollTop=~~(i.position().top-i[0].clientHeight*2):console.warn("Nothing to viewset with",n.item.view)}).on("open",function(){e.$root.find("button").attr("disable",!1)}).on("close",function(){e.$root.find("button").attr("disable",!0)})}var e=24,t=60,n=12,r=e*t;i.prototype.set=function(e,t,n){var r=this;return r.item[e=="enable"?"disable":e=="flip"?"enable":e]=r.queue[e].split(" ").map(function(i){return t=r[i](e,t,n)}).pop(),e=="select"?r.set("highlight",r.item.select,n):e=="highlight"?r.set("view",r.item.highlight,n):e=="interval"?r.set("min",r.item.min,n).set("max",r.item.max,n):(e=="flip"||e=="min"||e=="max"||e=="disable"||e=="enable")&&r.item.select&&r.item.highlight&&(e=="min"&&r.set("max",r.item.max,n),r.set("select",r.item.select,n).set("highlight",r.item.highlight,n)),r},i.prototype.get=function(e){return this.item[e]},i.prototype.create=function(n,i,s){var o=this;return i=i===undefined?n:i,Picker._.isObject(i)&&Picker._.isInteger(i.pick)?i=i.pick:Array.isArray(i)?i=+i[0]*t+ +i[1]:Picker._.isInteger(i)||(i=o.now(n,i,s)),n=="max"&&i<o.item.min.pick&&(i+=r),i=o.normalize(i,s),{hour:~~(e+i/t)%e,mins:(t+i%t)%t,time:(r+i)%r,pick:i}},i.prototype.now=function(e,n){var r=new Date,i=r.getHours()*t+r.getMinutes();return Picker._.isInteger(n)?n+=e=="min"&&n<0&&i===0?2:1:n=1,n*this.item.interval+i},i.prototype.normalize=function(e){return e-((e<0?this.item.interval:0)+e%this.item.interval)},i.prototype.measure=function(n,r,i){var s=this;return r?r===!0||Picker._.isInteger(r)?r=s.now(n,r,i):Picker._.isObject(r)&&Picker._.isInteger(r.pick)&&(r=s.normalize(r.pick,i)):r=n=="min"?[0,0]:[e-1,t-1],r},i.prototype.validate=function(e,t,n){var r=this,i=n&&n.interval?n.interval:r.item.interval;return r.disabled(t)&&(t=r.shift(t,i)),t=r.scope(t),r.disabled(t)&&(t=r.shift(t,i*-1)),t},i.prototype.disabled=function(e){var t=this,n=t.item.disable.filter(function(n){if(Picker._.isInteger(n))return e.hour==n;if(Array.isArray(n))return e.pick==t.create(n).pick}).length;return t.item.enable===-1?!n:n},i.prototype.shift=function(e,t){var n=this;while(n.disabled(e)){e=n.create(e.pick+=t||n.item.interval);if(e.pick<=n.item.min.pick||e.pick>=n.item.max.pick)break}return e},i.prototype.scope=function(e){var t=this.item.min.pick,n=this.item.max.pick;return this.create(e.pick>n?n:e.pick<t?t:e)},i.prototype.parse=function(e,n,r){var i=this,s={};if(!n||Picker._.isInteger(n)||Array.isArray(n)||Picker._.isDate(n)||Picker._.isObject(n)&&Picker._.isInteger(n.pick))return n;if(!r||!r.format)throw"Need a formatting option to parse this..";return i.formats.toArray(r.format).map(function(e){var t=i.formats[e],r=t?Picker._.trigger(t,i,[n,s]):e.replace(/^!/,"").length;t&&(s[e]=n.substr(0,r)),n=n.substr(r)}),+s.i+t*(+(s.H||s.HH)||+(s.h||s.hh)%12+(/^p/i.test(s.A||s.a)?12:0))},i.prototype.formats={h:function(e,t){return e?Picker._.digits(e):t.hour%n||n},hh:function(e,t){return e?2:Picker._.lead(t.hour%n||n)},H:function(e,t){return e?Picker._.digits(e):""+t.hour},HH:function(e,t){return e?Picker._.digits(e):Picker._.lead(t.hour)},i:function(e,t){return e?2:Picker._.lead(t.mins)},a:function(e,t){return e?4:r/2>t.time%r?"a.m.":"p.m."},A:function(e,t){return e?2:r/2>t.time%r?"AM":"PM"},toArray:function(e){return e.split(/(h{1,2}|H{1,2}|i|a|A|!.)/g)},toString:function(e,t){var n=this;return n.formats.toArray(e).map(function(e){return Picker._.trigger(n.formats[e],n,[0,t])||e.replace(/^!/,"")}).join("")}},i.prototype.flipItem=function(e,t){var n=this,r=n.item.disable,i=n.item.enable===-1;if(t=="flip")n.item.enable=i?1:-1;else if(!i&&e=="enable"||i&&e=="disable")r=n.removeDisabled(r,t);else if(!i&&e=="disable"||i&&e=="enable")r=n.addDisabled(r,t);return r},i.prototype.addDisabled=function(e,t){var n=this;return t.map(function(t){n.filterDisabled(e,t).length||e.push(t)}),e},i.prototype.removeDisabled=function(e,t){var n=this;return t.map(function(t){e=n.filterDisabled(e,t,1)}),e},i.prototype.filterDisabled=function(e,t,n){var r=Array.isArray(t);return e.filter(function(e){var i=!r&&t===e||r&&Array.isArray(e)&&t.toString()===e.toString();return n?!i:i})},i.prototype.i=function(e,t){return Picker._.isInteger(t)&&t>0?t:this.item.interval},i.prototype.nodes=function(e){var t=this,n=t.settings,r=t.item.select,i=t.item.highlight,s=t.item.view,o=t.item.disable;return Picker._.node("ul",Picker._.group({min:t.item.min.pick,max:t.item.max.pick,i:t.item.interval,node:"li",item:function(e){return e=t.create(e),[Picker._.trigger(t.formats.toString,t,[Picker._.trigger(n.formatLabel,t,[e])||n.format,e]),function(u,a){return r&&r.pick==a&&u.push(n.klass.selected),i&&i.pick==a&&u.push(n.klass.highlighted),s&&s.pick==a&&u.push(n.klass.viewset),o&&t.disabled(e)&&u.push(n.klass.disabled),u.join(" ")}([n.klass.listItem],e.pick),"data-pick="+e.pick]}})+Picker._.node("li",Picker._.node("button",n.clear,n.klass.buttonClear,"data-clear=1"+(e?"":" disable"))),n.klass.list)},i.defaults=function(e){return{clear:"Clear",format:"h:i A",interval:30,klass:{picker:e+" "+e+"--time",holder:e+"__holder",list:e+"__list",listItem:e+"__list-item",disabled:e+"__list-item--disabled",selected:e+"__list-item--selected",highlighted:e+"__list-item--highlighted",viewset:e+"__list-item--viewset",now:e+"__list-item--now",buttonClear:e+"__button--clear"}}}(Picker.klasses().picker),Picker.extend("pickatime",i)}(),define("jam/pickadate/_raw/lib/picker.time",function(){}),define("js/patterns/pickadate",["jquery","js/patterns/base","jam/pickadate/_raw/lib/picker","jam/pickadate/_raw/lib/picker.date","jam/pickadate/_raw/lib/picker.time"],function(e,t){var n=t.extend({name:"pickadate",defaults:{separator:" ",date:{formatSubmit:"dd-mm-yyyy"},time:{formatSubmit:"HH:i"},klassWrapper:"pat-pickadate-wrapper",klassSeparator:"pat-pickadate-separator",klassDate:"pat-pickadate-date",klassDateWrapper:"pat-pickadate-date-wrapper",klassTime:"pat-pickadate-time",klassTimeWrapper:"pat-pickadate-time-wrapper",klassClear:"pat-pickadate-clear"},ensureBool:function(e){if(typeof e=="string"){if(e==="true")return!0;if(e==="false")return!1}return e},init:function(){var t=this,n=t.options.date.onSet,r=t.options.time.onSet;t.$el.hide(),t.$wrapper=e("<div/>").addClass(t.options.klassWrapper).insertAfter(t.$el),t.options.date=t.ensureBool(t.options.date),t.options.time=t.ensureBool(t.options.time),t.options.date!==!1&&(t.$date=e('<input type="text"/>').addClass(t.options.klassDate).appendTo(e("<div/>").addClass(t.options.klassDateWrapper).appendTo(t.$wrapper)).pickadate(e.extend(!0,t.options.date,{onSet:function(){t.setDateTime(),n&&n.apply(this,arguments)}}))),t.options.date!==!1&&t.options.time!==!1&&(t.$separator=e("<span/>").addClass(t.options.klassSeparator).html(t.options.separator===" "?"&nbsp;":t.options.separator).appendTo(t.$wrapper)),t.options.time!==!1&&(t.$time=e('<input type="text"/>').addClass(t.options.klassTime).appendTo(e("<div/>").addClass(t.options.klassTimeWrapper).appendTo(t.$wrapper)).pickatime(e.extend(!0,t.options.time,{onSet:function(){t.setDateTime(),r&&r.apply(this,arguments)}}))),t.$clear=e("<div/>").addClass(t.options.klassClear).appendTo(t.$wrapper)},setDateTime:function(){var e=this,t="";e.$date&&(t+=e.$date.val()),e.$date&&e.$time&&(t+=e.options.separator),e.$time&&(t+=e.$time.val()),e.$el.val(t)}});return n}),define("js/patterns/autotoc",["jquery","js/patterns/base"],function(e,t,n){var r=t.extend({name:"autotoc",defaults:{section:"section",levels:"h1,h2,h3",IDPrefix:"autotoc-item-",klassTOC:"autotoc-nav",klassSection:"autotoc-section",klassLevelPrefix:"autotoc-level-",klassActive:"active",scrollDuration:"slow",scrollEasing:"swing"},init:function(){var t=this;t.$toc=e("<nav/>").prependTo(t.$el).addClass(t.options.klassTOC),t.options.klass&&t.$el.addClass(t.options.klass),e(t.options.section,t.$el).addClass(t.options.klassSection),e(t.options.levels,t.$el).each(function(n){var r=e(this),i=r.prop("id")?"#"+r.prop("id"):r.parents(t.options.section).prop("id");i||(i=t.options.IDPrefix+t.name+"-"+n,r.prop("id",i)),e("<a/>").appendTo(t.$toc).text(r.text()).prop("href",i).addClass(t.options.klassLevelPrefix+t.getLevel(r)).on("click",function(n,i){n.stopPropagation(),n.preventDefault(),t.$el.children("."+t.options.klassActive).removeClass(t.options.klassActive),e(n.target).addClass(t.options.klassActive),r.parents(t.options.section).addClass(t.options.klassActive),i!==!1&&t.options.scrollDuration&&r&&e("body,html").animate({scrollTop:r.offset().top},t.options.scrollDuration,t.options.scrollEasing),t.$el.parents(".modal").size()!==0&&t.$el.trigger("resize.modal.patterns")})}),t.$toc.find("a").first().trigger("click",!1)},getLevel:function(t){var n=0;return e.each(this.options.levels.split(","),function(e,r){if(t.filter(r).size()===1)return n=e+1,!1}),n}});return r}),function(e){typeof define=="function"&&define.amd&&define.amd.jQuery?define("jam/jquery-cookie/jquery.cookie",["jquery"],e):e(jQuery)}(function(e){function n(e){return e}function r(e){return decodeURIComponent(e.replace(t," "))}function i(e){e.indexOf('"')===0&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return s.json?JSON.parse(e):e}catch(t){}}var t=/\+/g,s=e.cookie=function(t,o,u){if(o!==undefined){u=e.extend({},s.defaults,u);if(typeof u.expires=="number"){var a=u.expires,f=u.expires=new Date;f.setDate(f.getDate()+a)}return o=s.json?JSON.stringify(o):String(o),document.cookie=[encodeURIComponent(t),"=",s.raw?o:encodeURIComponent(o),u.expires?"; expires="+u.expires.toUTCString():"",u.path?"; path="+u.path:"",u.domain?"; domain="+u.domain:"",u.secure?"; secure":""].join("")}var l=s.raw?n:r,c=document.cookie.split("; "),h=t?undefined:{};for(var p=0,d=c.length;p<d;p++){var v=c[p].split("="),m=l(v.shift()),g=l(v.join("="));if(t&&t===m){h=i(g);break}t||(h[m]=i(g))}return h};s.defaults={},e.removeCookie=function(t,n){return e.cookie(t)!==undefined?(e.cookie(t,"",e.extend(n,{expires:-1})),!0):!1}}),define("js/patterns/accessibility",["jquery","js/patterns/base","jam/jquery-cookie/jquery.cookie"],function(e,t,n){var r=t.extend({name:"accessibility",defaults:{smallbtn:null,normalbtn:null,largebtn:null},setBaseFontSize:function(t,n){n&&(this.$el.removeClass("smallText").removeClass("largeText").removeClass("mediumText"),e.cookie("fontsize",t,{expires:365,path:"/"})),this.$el.addClass(t)},initBtn:function(e){var t=this;e.el.click(function(n){n.preventDefault(),t.setBaseFontSize(e.name+"Text",1)})},init:function(){var t=this,n=e.cookie("fontsize");n&&t.setBaseFontSize(n,0);var r=["smallbtn","normalbtn","largebtn"];e.each(r,function(n,r){var i=r.replace("btn",""),s=t.options[r];if(s!==null){var o=e(s,t.$el);o&&(r={name:i,el:o},t[i]=r,t.initBtn(r))}})}});return r}),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.4";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return e==null?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},x.filter=x.select=function(e,t,n){var r=[];return e==null?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return e==null?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return e==null?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};x.contains=x.include=function(e,t){return e==null?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?null:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t||x.identity);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=n==null?x.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return e==null?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,0,t):e[0]},x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},x.last=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){if(t?!r||o[o.length-1]!==n:!x.contains(o,n))o.push(n),s.push(e[r])}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=x.pluck(e,""+r);return n},x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s},x.bind=function(e,t){if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));var n=u.call(arguments,2);return function(){return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);return t.length===0&&(t=x.functions(e)),T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,f<=0?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]==null&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var O=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if(i=="[object Array]"){o=e.length,u=o==t.length;if(u)while(o--)if(!(u=O(e[o],t[o],n,r)))break}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)){o++;if(!(u=x.has(t,c)&&O(e[c],t[c],n,r)))break}if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return O(e,t,[],[])},x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&e.nodeType===1},x.isArray=w||function(e){return f.call(e)=="[object Array]"},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),typeof /./!="function"&&(x.isFunction=function(e){return typeof e=="function"}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"},x.isNull=function(e){return e===null},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){var r=Array(e);for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=x.invert(M.escape);var _={escape:new RegExp("["+x.keys(M.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(M.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return t==null?"":(""+t).replace(_[e],function(t){return M[e][t]})}}),x.result=function(e,t){if(e==null)return null;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),j.call(this,n.apply(x,e))}})};var D=0;x.uniqueId=function(e){var t=++D+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||P).source,(n.interpolate||P).source,(n.evaluate||P).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(B,function(e){return"\\"+H[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var j=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],j.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return j.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("underscore",["underscore/underscore"],function(e){return e}),define("underscore/underscore",function(){}),define("js/patterns/queryhelper",["jquery","js/patterns/base"],function(e,t){var n=t.extend({name:"queryhelper",defaults:{ajaxvocabulary:null,searchParam:"SearchableText",attributes:["UID","Title","Description","getURL","Type"],batchSize:10},init:function(e){var t=this;e===undefined&&(e={browsing:!1}),t.basePattern=e,t.options.ajaxvocabulary!==undefined&&t.options.ajaxvocabulary!==null?t.valid=!0:t.valid=!1},selectAjax:function(){var e=this;return{url:e.options.ajaxvocabulary,dataType:"JSON",quietMillis:100,data:function(t,n){t&&(t+="*");var r=[{i:e.options.searchParam,o:"plone.app.querystring.operation.string.contains",v:t}],i=e.basePattern;i.browsing&&r.push({i:"path",o:"plone.app.querystring.operation.string.path",v:i.currentPath?i.currentPath:i.options.basePath});var s={query:JSON.stringify({criteria:r}),batch:JSON.stringify({page:n,size:e.options.batchSize}),attributes:JSON.stringify(e.options.attributes)};return s},results:function(e,t){var n=t*10<e.total;return{results:e.results,more:n}}}},search:function(t,n,r,i){var s=this,o={query:JSON.stringify({criteria:[{i:t,o:n,v:r}]}),attributes:JSON.stringify(s.options.attributes)};e.ajax({url:s.options.ajaxvocabulary,dataType:"JSON",data:o,success:i})}});return n}),define("js/patterns/relateditems",["jquery","underscore","js/patterns/base","js/patterns/select2","js/patterns/queryhelper"],function(e,t,n,r,i){var s=n.extend({name:"relateditems",browsing:!1,currentPath:null,defaults:{multiple:!0,tokenSeparators:[","," "],separator:",",orderable:!0,cache:!0,closeOnSelect:!1,basePath:"/",browseText:"Browse",searchText:"Search",homeText:"home",folderTypes:["Folder"],attributes:["id:UID","title:Title","Type","path"],dropdownCssClass:"pat-relateditems-dropdown",resultTemplate:'<div class="pat-relateditems-result pat-relateditems-type-<%= type %>"> <span class="pat-relateditems-buttons">  <% if (type === "folder") { %>     <a class="pat-relateditems-result-browse" href="#" data-path="<%= path %>">       <i class="icon-folder-open"></i>    </a>   <% } %>   <a class="pat-relateditems-result-select" href="#">       <i class="icon-plus-sign"></i>   </a> </span> <span class="pat-relateditems-result-title"><%= title %></span> <span class="pat-relateditems-result-path"><%= path %></span></div>',resultTemplateSelector:null,selectionTemplate:'<span class="pat-relateditems-item pat-relateditems-type-<%= type %>"> <span class="pat-relateditems-item-title"><%= title %></span> <span class="pat-relateditems-item-path"><%= path %></span></span>',selectionTemplateSelector:null,tabsTemplate:'<div class="pat-relateditems-tabs tabs"> <a href="#" class="pat-relateditems-tabs-search tab active"><%= searchText %></a> <a href="#" class="pat-relateditems-tabs-browse tab"><%= browseText %></a></div>',tabsTemplateSelector:null,breadCrumbsTemplate:'<span><a href="/"><i class="icon-home"></i></a><%= items %></span>',breadCrumbsTemplateSelector:null,breadCrumbTemplate:'/<a href="<%= path %>"><%= text %></a>',breadCrumbTemplateSelector:null,escapeMarkup:function(e){return e}},applyTemplate:function(n,r){var i=this,s;return i.options[n+"TemplateSelector"]?(s=e(i.options[n+"TemplateSelector"]).html(),s||(s=i.options[n+"Template"])):s=i.options[n+"Template"],t.template(s,r)},activateBrowsing:function(){var e=this;e.browsing=!0,e.setBreadCrumbs(),e.setTabs()},deactivateBrowsing:function(){var e=this;e.browsing=!1,e.setBreadCrumbs(),e.setTabs()},browseTo:function(e){var t=this;t.trigger("before-browse"),t.currentPath=e,t.activateBrowsing(),t.$el.select2("close"),t.$el.select2("open"),t.trigger("after-browse")},setTabs:function(){var e=this;e.browsing?(e.$browseBtn.addClass("active"),e.$searchBtn.removeClass("active")):(e.$browseBtn.removeClass("active"),e.$searchBtn.addClass("active"))},setBreadCrumbs:function(){var n=this,r=n.currentPath?n.currentPath:n.options.basePath;if(n.browsing){var i;if(r==="/")i=n.applyTemplate("breadCrumbs",{items:""});else{var s=r.split("/"),o="",u="";t.each(s,function(e){if(e!==""){var t={};o=o+"/"+e,t.text=e,t.path=o,u+=n.applyTemplate("breadCrumb",t)}}),i=n.applyTemplate("breadCrumbs",{items:u})}var a=e(i);e("a",a).on("click",function(t){return n.browseTo(e(this).attr("href")),!1}),n.$browsePath.html(a)}else n.$browsePath.html("")},selectItem:function(e){var t=this;t.trigger("selecting");var n=t.$el.select2("data");n.push(e),t.$el.select2("data",n),t.trigger("selected")},init:function(){var t=this;t.query=new i(t.$el,t.options),t.query.init(t),t.$el.wrap('<div class="pat-relateditems-container" />'),t.$container=t.$el.parents(".pat-relateditems-container"),t.$container.width(t.options.width),r.prototype.initializeValueMap.call(t),r.prototype.initializeTags.call(t),r.prototype.initializeOrdering.call(t),t.query.valid?t.options.ajax=t.query.selectAjax():t.options.tags=[],t.options.formatSelection=function(e){return t.applyTemplate("selection",e)},t.options.formatResult=function(n){!n.Type||t.options.folderTypes.indexOf(n.Type)===-1?n.type="page":n.type="folder";var r=e(t.applyTemplate("result",n));return e(".pat-relateditems-result-select",r).on("click",function(e){return t.selectItem(n),!1}),e(".pat-relateditems-result-browse",r).on("click",function(n){var r=e(this).data("path");return t.browseTo(r),!1}),e(r)},t.options.initSelection=function(n,r){var i=[],s=e(n).val();if(s!==""){var o=s.split(",");t.query.search("UID","plone.app.querystring.operation.list.contains",o,function(e){r(e.results)})}},r.prototype.initializeSelect2.call(t);var n={browseText:t.options.browseText,searchText:t.options.searchText};t.$browse=e(t.applyTemplate("tabs",n)),t.$container.prepend(t.$browse),t.$browseBtn=e(".pat-relateditems-tabs-browse",t.$browse),t.$searchBtn=e(".pat-relateditems-tabs-search",t.$browse),t.$browsePath=e('<span class="pat-relateditems-path" />'),t.$browse.after(t.$browsePath),t.$browsePath.width(t.$container.width()-2),t.deactivateBrowsing(),t.$browseBtn.click(function(e){return t.activateBrowsing(),t.$el.select2("close"),t.$el.select2("open"),!1}),t.$searchBtn.click(function(e){return t.deactivateBrowsing(),t.$el.select2("close"),t.$el.select2("open"),!1}),t.$el.on("select2-selecting",function(e){e.preventDefault()})}});return s}),define("js/patterns/formUnloadAlert",["jquery","js/patterns/base"],function(e,t,n){var r=t.extend({name:"formunloadalert",_changed:!1,_suppressed:!1,defaults:{message:"Discard changes? If you click OK, any changes you have made will be lost.",changingEvents:"change keyup paste",changingFields:"input,select,textarea,fileupload"},init:function(){var t=this;if(!t.$el.is("form"))return;e(t.options.changingFields,t.$el).on(t.options.changingEvents,function(e){t._changed=!0}),e(window).on("beforeunload",function(e){return t._handle_unload(t,e)}),t.$el.on("submit",function(e){t._suppressed=!0})},_handle_unload:function(e,t){if(e._suppressed)return e._suppressed=!1,undefined;if(e._changed){var n=e.options.message;return(t||window.event).returnValue=n,n}}});return r}),define("js/patterns/toggle",["jquery","js/patterns/base"],function(e,t,n){var r=t.extend({name:"toggle",defaults:{attribute:"class",event:"click",externalClose:!0,preventDefault:!0},ensureBool:function(e){return typeof e=="string"?e==="true"?!0:!1:e},init:function(){var t=this;t.options.externalClose=t.ensureBool(t.options.externalClose),t.options.preventDefault=t.ensureBool(t.options.preventDefault),t.options.target?t.$target=e(t.options.target):t.$target=t.$el,t.$target||e.error('No target found for "'+t.options.target+'".'),t.on(t.options.event,function(e){t.toggle(),e.stopPropagation();if(t.options.preventDefault)return!1}),t.options.externalClose&&e("html").on(t.options.event,function(){t.remove()})},isMarked:function(){var e=this,t=!1;for(var n=0;n<this.$target.length;n++){if(this.$target.eq(n)[0]===e.$el[0])continue;if(e.options.attribute==="class"){if(!this.$target.eq(n).hasClass(this.options.value)){t=!1;break}t=!0}else{if(this.$target.eq(n).attr(this.options.attribute)!==this.options.value){t=!1;break}t=!0}}return t},toggle:function(){var e=this;e.isMarked()?e.remove():e.add()},remove:function(){var e=this;e.trigger("remove-attr"),e.options.attribute==="class"?e.$target.removeClass(e.options.value):e.$target.removeAttr(e.options.attribute),e.trigger("attr-removed")},add:function(){var e=this;e.trigger("add-attr"),e.options.attribute==="class"?e.$target.addClass(e.options.value):e.$target.attr(e.options.attribute,e.options.value),e.trigger("added-attr")}});return r}),define("js/tinymce/plonebrowser",["jquery","js/patterns/base"],function(e,t){var n=t.extend({name:"plonebrowser",file_browser_callback:function(t,n,r,i){i=tinymce.activeEditor.windowManager.open({title:"Find content to link to",width:800,height:400,html:'<div class="plonelink"><div class="top">'+(new tinymce.ui.Button({text:"Sort"})).renderHtml()+(new tinymce.ui.Button({text:"Filter"})).renderHtml()+(new tinymce.ui.TextBox({text:"Search"})).renderHtml()+"</div>"+'<div class="crumbs">'+'<a href="#">/</a>'+'<a href="#">foobar</a>'+"</div>"+'<div class="browser">'+"<table>"+"<thead>"+"<tr>"+"<th>Title</th>"+"<th>Modified</th>"+"<th>Type</th>"+"</tr>"+"</thead>"+"<tbody>"+"</tbody>"+"</table>"+"</div></div>"});var s=e("#"+i._id),o=s.find("tbody"),u=s.find(".crumbs")},init:function(){var e=this}});return n}),define("js/patterns/tinymce",["jquery","js/patterns/base","js/tinymce/plonebrowser"],function(e,t,n){var r=t.extend({name:"tinymce",init:function(){var e=this,t=e.$el.attr("id");t===undefined&&(t="tiny"+Math.floor((1+Math.random())*65536).toString(16).substring(1),e.$el.attr("id",t)),e.options.selector="#"+t,e.options.plugins=["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste link link"],e.options.toolbar="insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | unlink link image",e.browser=new n(e.$el),e.options.file_browser_callback=e.browser.file_browser_callback,e.tiny=tinymce.init(e.options)}});return r}),define("js/patterns/picture",["jquery","js/patterns/base"],function(e,t){var n=t.extend({name:"picture",defaults:{alt:"",klass:{loading:"picture-loading",error:"picture-error"},attribute:{src:"data-src",media:"data-media"}},init:function(){var t=this,r;n.__queue_picture_patterns===undefined&&(n.__queue_picture_patterns=[],e(window).on("queue.picture.patterns",function(){e(".pat-picture").length===n.__queue_picture_patterns.length&&(e.each(n.__queue_picture_patterns,function(e,t){t.display()}),n.__queue_picture_patterns=[])})),r=function(e){var t=e.data.context;t.queue()},e(window).on("resize",{context:t},r),t.queue()},queue:function(){var e=this;e.visible()?n.__queue_picture_patterns.unshift(e):n.__queue_picture_patterns.push(e),e.trigger("queue")},display:function(){var t=this,n=[],r=e("img",t.$el);e("["+t.options.attribute.src+"]",t.$el).each(function(){var r=e(this);(!r.attr(t.options.attribute.media)||t.matchMedia(r.attr(t.options.attribute.media)))&&n.push(r)});if(!n.length)return;r.length||(r=e("<img />").attr("alt",t.options.alt),t.$el.append(r)),r.load(function(){t.$el.removeClass(t.options.klass.loading),t.trigger("complete")}).error(function(){t.$el.addClass(t.options.klass.error),t.trigger("error")}),t.$el.addClass(t.options.klass.loading),r.attr("src",n.pop().attr(t.options.attribute.src)),t.trigger("loading")},visible:function(){var t=this,n=e(window).scrollTop(),r=n+e(window).height(),i=t.$el.offset().top,s=i+t.$el.height();return s>=n&&i<=r},matchMedia:function(e){var t,n=document.documentElement,r=n.firstElementChild||n.firstChild,i=document.createElement("body"),s=document.createElement("div");return s.id="mq-test-1",s.style.cssText="position:absolute;top:-100em",i.style.background="none",i.appendChild(s),s.innerHTML='&shy;<style media="'+e+'"> #mq-test-1 { width: 42px; }</style>',n.insertBefore(i,r),t=s.offsetWidth===42,n.removeChild(i),t}});return n}),define("js/patterns/livesearch",["jquery","js/patterns/base","js/patterns/toggle","underscore","js/patterns/select2","js/patterns/queryhelper"],function(e,t,n,r,i,s){var o=t.extend({name:"livesearch",defaults:{multiple:!0,closeOnSelect:!1,minimumInputLength:3,tokenSeparators:[","," "],dropdownCssClass:"pat-livesearch-dropdown",linkSelector:"pat-livesearch-result-title",resultTemplate:'<div class="pat-livesearch-result pat-livesearch-type-<%= Type %>"><a class="pat-livesearch-result-title" href="<%= getURL %>"><%= Title %></a><p class="pat-livesearch-result-desc"><%= Description %></p></div>',resultTemplateSelector:null,isTest:!1,id:function(e){return e.UID}},init:function(){var t=this;t.query=new s(t.$el,t.options),t.query.init(t),t.query.valid||e.error("No url provided for livesearch results "+t.$el),i.prototype.initializeValueMap.call(t),i.prototype.initializeTags.call(t),i.prototype.initializeOrdering.call(t),t.query.valid?t.options.ajax=t.query.selectAjax():t.options.tags=[],t.options.formatResult=function(n){var r=e(t.applyTemplate("result",n));return e(r)},i.prototype.initializeSelect2.call(t),t.$el.on("select2-selecting",function(e,n){e.preventDefault(),t.select()})},applyTemplate:function(t,n){var i=this,s;return i.options[t+"TemplateSelector"]?(s=e(i.options[t+"TemplateSelector"]).html(),s||(s=i.options[t+"Template"])):s=i.options[t+"Template"],r.template(s,n)},select:function(){var t=this,n=t.$el.data().select2,r=n.dropdown,i=e(".select2-highlighted",r),s=e("."+t.options.linkSelector,i),o=s.attr("href");o&&(t.options.isTest?t.testTarget=o:window.location=o)}});return o}),define("js/patterns/querystring",["jquery","js/patterns/base","js/patterns/select2","js/patterns/pickadate"],function(e,t,n,r,i){var s=function(){this.init.apply(this,arguments)};s.prototype={defaults:{indexWidth:"20em",placeholder:"Select criteria",remove:"Remove line",results:" items matching your search.",days:"days",klassWrapper:"querystring-criteria-wrapper",klassIndex:"querystring-criteria-index",klassOperator:"querystring-criteria-operator",klassValue:"querystring-criteria-value",klassRemove:"querystring-criteria-remove",klassResults:"querystring-criteria-results",klassClear:"querystring-criteria-clear"},init:function(t,n,r,s,o,u){var a=this;a.options=e.extend(!0,{},a.defaults,n),a.indexes=r,a.indexGroups={},a.$wrapper=e("<div/>").addClass(a.options.klassWrapper).appendTo(t),a.$remove=e("<div/>").addClass(a.options.klassRemove).appendTo(a.$wrapper).on("click",function(e){a.remove(),a.trigger("remove")}),a.$index=e("<select/>"),e.each(a.indexes,function(t,n){n.enabled&&(a.indexGroups[n.group]||(a.indexGroups[n.group]=e("<optgroup/>").attr("label",n.group).appendTo(a.$index)),a.indexGroups[n.group].append(e("<option/>").attr("value",t).html(n.title)))}),a.$wrapper.append(e("<div/>").addClass(a.options.klassIndex).append(a.$index)),a.$index.patternSelect2({width:a.options.indexWidth,placeholder:a.options.placeholder}).on("change",function(e){a.removeValue(),a.createOperator(e.val),a.createClear(),a.trigger("index-changed")}),s!==i&&(a.$index.select2("val",s),a.createOperator(s,o,u),a.createClear())},createOperator:function(t,n,r){var s=this;s.removeOperator(),s.$operator=e("<select/>"),s.indexes[t]&&e.each(s.indexes[t].operators,function(t,n){e("<option/>").attr("value",t).html(n.title).appendTo(s.$operator)}),s.$wrapper.append(e("<div/>").addClass(s.options.klassOperator).append(s.$operator)),s.$operator.patternSelect2({width:"10em"}).on("change",function(e){s.createValue(t),s.createClear(),s.trigger("operator-changed")}),n===i&&(n=s.$operator.select2("val")),s.$operator.select2("val",n),s.createValue(t,r)},createValue:function(t,n){var r=this,s=r.indexes[t].operators[r.$operator.val()].widget,o=e("<div/>").addClass(r.options.klassValue).appendTo(r.$wrapper);r.removeValue(),s==="StringWidget"?r.$value=e('<input type="text"/>').addClass(r.options.klassValue+"-"+s).appendTo(o):s==="DateWidget"?r.$value=e('<input type="text"/>').addClass(r.options.klassValue+"-"+s).appendTo(o).patternPickadate({time:!1,date:{format:"dd/mm/yyyy"}}):s==="DateRangeWidget"?r.$value=e('<input type="text"/>').appendTo(o):s==="RelativeDateWidget"?r.$value=e('<input type="text"/>').after(e("<span/>").html(r.options.days)).addClass(r.options.klassValue+"-"+s).appendTo(o):s==="ReferenceWidget"?r.$value=e('<input type="text"/>').addClass(r.options.klassValue+"-"+s).appendTo(o):s==="RelativePathWidget"?r.$value=e('<input type="text"/>').addClass(r.options.klassValue+"-"+s).appendTo(o):s==="MultipleSelectionWidget"&&(r.$value=e("<select/>").attr("multiple",!0).addClass(r.options.klassValue+"-"+s).appendTo(o),r.indexes[t]&&e.each(r.indexes[t].values,function(t,n){e("<option/>").attr("value",t).html(n.title).appendTo(r.$value)}),r.$value.patternSelect2({width:"250px"})),n!==i&&r.$value.select2("val",n)},createClear:function(){var t=this;t.removeClear(),t.$clear=e("<div/>").addClass(t.options.klassClear).appendTo(t.$wrapper)},remove:function(){var e=this;e.$remove.remove(),e.$index.parent().remove(),e.removeOperator(),e.removeValue(),e.removeClear()},removeClear:function(){var e=this;e.$clear&&e.$clear.remove()},removeOperator:function(){var e=this;e.$operator&&e.$operator.parent().remove()},removeValue:function(){var e=this;e.$value&&e.$value.parent().remove()},trigger:function(e){this.$wrapper.trigger(e+"-criteria.querystring.patterns",[this])},on:function(e,t){this.$wrapper.on(e+"-criteria.querystring.patterns",t)}};var o=t.extend({name:"querystring",defaults:{indexes:[],klassWrapper:"querystring-wrapper",criteria:{}},init:function(){var t=this;t.$el.hide(),t.$wrapper=e("<div/>").addClass(t.options.klassWrapper),t.$el.after(t.$wrapper),t.criterias=[],e.each(JSON.parse(t.$el.val()),function(e,n){t.createCriteria(n.i,n.o,n.v)}),t.createCriteria()},createCriteria:function(e,t,n){var r=this,i=new s(r.$wrapper,r.options.criteria,r.options.indexes,e,t,n);i.on("remove",function(e){r.criterias[r.criterias.length-1]===i&&r.createCriteria()}),i.on("index-changed",function(e){r.criterias[r.criterias.length-1]===i&&r.createCriteria()}),r.criterias.push(i)}});return o}),define("js/patterns/preventdoublesubmit",["jquery","js/patterns/base"],function(e,t,n){var r=t.extend({name:"preventdoublesubmit",defaults:{message:"You already clicked the submit button. Do you really want to submit this form again?",guardKlass:"submitting",optOutKlass:"allowMultiSubmit",changedKlass:"changed"},init:function(){var t=this;if(!t.$el.is("form"))return;e(":submit",t.$el).click(function(){e(":submit").removeAttr("clicked"),e(this).attr("clicked","clicked");if(e(this).hasClass(t.options.guardKlass)&&!e(this).hasClass(t.options.optOutKlass))return t._confirm();e(this).addClass(t.options.guardKlass)})},_confirm:function(){return window.confirm(this.options.message)}});return r}),define("js/patterns/formautofocus",["jquery","js/patterns/base"],function(e,t,n){var r=t.extend({name:"formautofocus",defaults:{condition:"div.error",target:"div.error :input:not(.formTabs):visible:first",always:":input:not(.formTabs):visible:first"},init:function(){var t=this;e(t.options.condition,t.$el).size()!==0?e(t.options.target,t.$el).focus():e(t.options.always,t.$el).focus()}});return r}),window.jQuery&&define("jquery",[],function(){return window.jQuery}),define("js/bundles/widgets",["jquery","jam/Patterns/src/registry","js/patterns/select2","js/patterns/pickadate","js/patterns/autotoc","js/patterns/accessibility","js/patterns/relateditems","js/patterns/formUnloadAlert","js/patterns/toggle","js/patterns/tinymce","js/patterns/picture","js/patterns/livesearch","js/patterns/querystring","js/patterns/preventdoublesubmit","js/patterns/formautofocus"],function(e,t){var n={name:"plone-widgets",transform:function(t){var n=t.filter(".enableFormTabbing");n=n.add(t.find(".enableFormTabbing")),n.addClass("pat-autotoc"),n.attr({"data-pat-autotoc":"levels: legend;section: fieldset;klass: autotabs"}),t.addClass("pat-accessibility"),t.attr({"data-pat-accessibility":"smallbtn: #accessibility-smallText;normalbtn: #accessibility-normalText;largebtn: #accessibility-largeText"});var n=t.filter(".enableUnloadProtection");n=n.add(t.find(".enableUnloadProtection")),n.addClass("pat-formunloadalert"),n.attr({"data-pat-formunloadalert":"message: "+window.form_modified_message});var r=e("dl.actionMenu#portal-personaltools dt.actionMenuHeader a");r.addClass("pat-toggle"),r.attr({"data-pat-toggle":"target: dl.actionMenu#portal-personaltools;value: activated"});var i=e("dl.actionMenu#plone-contentmenu-factories dt.actionMenuHeader a");i.addClass("pat-toggle"),i.attr({"data-pat-toggle":"target: dl.actionMenu#plone-contentmenu-factories;value: activated"});var s=e("dl.actionMenu#plone-contentmenu-display dt.actionMenuHeader a");s.addClass("pat-toggle"),s.attr({"data-pat-toggle":"target: dl.actionMenu#plone-contentmenu-display;value: activated"});var o=e("dl.actionMenu#plone-contentmenu-workflow dt.actionMenuHeader a");o.addClass("pat-toggle"),o.attr({"data-pat-toggle":"target: dl.actionMenu#plone-contentmenu-workflow;value: activated"});var u=e("form[name=searchform] dl.actionMenu dt.actionMenuHeader a");u.addClass("pat-toggle"),u.attr({"data-pat-toggle":"target: form[name=searchform] dl.actionMenu;value: activated"}),e("dl.actionMenu").removeClass("deactivated"),e("html").on("mousedown",function(t){e(t.toElement).parents("dl.actionMenu").hasClass("activated")||e("dl.actionMenu").removeClass("activated")}),n=t.find(".LSBox");var a=n.parents("form").attr("action").replace("@@search","@@getVocabulary?name=plone.app.vocabularies.Catalog"),f={ajaxvocabulary:a};n.attr({"class":"pat-livesearch","data-pat-livesearch":JSON.stringify(f)}),n.find(".searchSection").remove(),t.find(".mce_editable").addClass("pat-tinymce"),e("[onclick^='toggleSelect']").attr("onclick",null);var l=e("form[action$=content_status_history] table.listing > thead tr th input[type=checkbox]");l.addClass("pat-toggle"),l.attr({"data-pat-toggle":"target: table.listing input[type=checkbox];attribute: checked;value: checked;externalClose: false;preventDefault: false"}),l=e("form[action*=usergroup-groupmembership] table.listing tr th input[type=checkbox]"),l.addClass("pat-toggle"),l.attr({"data-pat-toggle":"target: table.listing input[type=checkbox];attribute: checked;value: checked;externalClose: false;preventDefault: false"}),l=e("form[action*=usergroup-usermembership] table.listing tr th input[type=checkbox]"),l.addClass("pat-toggle"),l.attr({"data-pat-toggle":"target:form[action*=usergroup-usermembership] table.listing:last input[type=checkbox];attribute: checked;value: checked;externalClose: false;preventDefault: false"}),l=e("[onchange*='toggleSelect']").attr("onchange",null),l.addClass("pat-toggle"),l.attr({"data-pat-toggle":"target:form[name=searchform] dd.actionMenuContent input[type=checkbox];attribute: checked;value: checked;externalClose: false;preventDefault: false"}),e("form").addClass("pat-preventdoublesubmit"),e("form").attr({"data-pat-preventdoublesubmit":"message:"+window.form_resubmit_message});var c=e('form[action*="++add++"]');c.addClass("pat-formautofocus");var h=e('form[action*="@@edit"]');h.addClass("pat-formautofocus")},scan:function(n){t.scan(e(n))}};return t.register(n),n});require(['jquery', 'jam/Patterns/src/registry', 'js/bundles/widgets'], function(jQuery, registry) { jQuery(document).ready(function() { registry.scan(jQuery('body')); }); });
